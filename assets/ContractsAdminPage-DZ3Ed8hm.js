const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-D-5srVFd.js","assets/index-GuXP6Wz1.js","assets/index-CgdCZFPi.css"])))=>i.map(i=>d[i]);
import{r as c,R as W,j as e,C as ie,d as S,B,D as oe,E as X,e as I,n as ne}from"./index-GuXP6Wz1.js";import{S as le}from"./SearchIcon-DpzGgnsg.js";import{E as de}from"./EyeIcon-DK32TFZi.js";import{D as ce}from"./DownloadIcon-c-2MRTgG.js";import{S as xe}from"./ShieldIcon-ByVKx3T4.js";import{E as Z}from"./ExclamationIcon-DRlgwyPd.js";import{C as P}from"./CheckCircleIcon-aPMIrVJF.js";import{X as J}from"./XCircleIcon-0yDfXLBp.js";import{F as me}from"./FileIcon-DrYmMUVd.js";import{S as ue}from"./SignatureIcon-p7_znFYD.js";import{C as ge}from"./CreditCardIcon-CrTjyf2t.js";import{S as K}from"./StarIcon-C41slj-a.js";import{M as pe}from"./MessagesIcon-B3XHWK-r.js";import{g as he,i as be}from"./financeUtils-CtoX7Xu7.js";const L=({active:o,completed:l,icon:s,label:b,date:x})=>e.jsxs("div",{className:`flex flex-col items-center flex-1 relative z-10 ${!o&&!l?"opacity-50":""}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all duration-300 bg-gray-800 ${l?"border-green-500 text-green-500":o?"border-primary text-primary":"border-gray-600 text-gray-600"}`,children:l?e.jsx(P,{className:"w-6 h-6"}):s}),e.jsx("span",{className:`text-xs mt-2 font-medium text-center ${l?"text-green-400":o?"text-white":"text-gray-500"}`,children:b}),x&&e.jsx("span",{className:"text-[10px] text-gray-500 mt-1",children:new Date(x).toLocaleDateString("pt-BR")})]}),U=({active:o})=>e.jsx("div",{className:`flex-1 h-1 mx-2 transition-colors duration-300 ${o?"bg-green-500":"bg-gray-700"}`}),fe=o=>{if(!o)return{terms:"",logs:[]};const l=o.split(/\n\n(?=\[)/g),s=l[0],x=l.slice(1).map(p=>{const f=p.match(/^\[(.*?)\]:\s*(.*)/s);return f?{header:f[1],message:f[2],original:p}:{header:"Registro",message:p,original:p}});return{terms:s,logs:x}},ye=o=>{const l=[];let s=0;const b=new Date(o.criado_em);return new Date(o.data_evento)<b?(l.push({status:"warning",text:"Data do evento anterior à criação do contrato (Retroativo?)."}),s+=20):l.push({status:"ok",text:"Cronologia de criação válida."}),o.status==="concluido"&&!o.data_pagamento?(l.push({status:"error",text:"Inconsistência: Status CONCLUÍDO mas sem Data de Pagamento."}),s+=50):o.status==="concluido"&&l.push({status:"ok",text:"Pagamento registrado corretamente."}),(o.status==="assinado"||o.status==="concluido")&&(!o.assinatura_artista||!o.assinatura_estabelecimento?(l.push({status:"error",text:"Inconsistência: Status avançado mas faltam assinaturas booleanas."}),s+=30):l.push({status:"ok",text:"Assinaturas digitais válidas."})),(o.valor||0)<=0?(l.push({status:"warning",text:"Alerta: Contrato com valor zero ou não definido."}),s+=10):l.push({status:"ok",text:"Valor financeiro definido."}),o.data_pagamento&&new Date(o.data_pagamento)<b&&(l.push({status:"error",text:"Erro Crítico: Data de pagamento anterior à criação."}),s+=50),{checks:l,riskScore:Math.min(s,100)}},je=({isOpen:o,onClose:l,contract:s,onRefresh:b})=>{var G,H;const[x,p]=c.useState("info"),[f,T]=c.useState([]),[C,E]=c.useState(!1),[_,u]=c.useState(!1),[w,g]=c.useState(null),[j,O]=c.useState({artist:0,venue:0}),[A,r]=c.useState(s.status),[y,N]=c.useState(((G=s.taxa_servico)==null?void 0:G.toString())||""),[$,q]=c.useState(""),M=c.useRef(null);W.useEffect(()=>{var a;o&&(r(s.status),N(((a=s.taxa_servico)==null?void 0:a.toString())||""),Q(s))},[o,s]),W.useEffect(()=>{if(w){const a=setTimeout(()=>g(null),5e3);return()=>clearTimeout(a)}},[w]);const Q=async a=>{var m,v,D,R;const t=Array.isArray(a.artistas)?(m=a.artistas[0])==null?void 0:m.id:(v=a.artistas)==null?void 0:v.id,i=Array.isArray(a.estabelecimentos)?(D=a.estabelecimentos[0])==null?void 0:D.id:(R=a.estabelecimentos)==null?void 0:R.id,d=async k=>{if(!k)return 0;const z=await oe.getByTargetId(k);return z.length===0?0:z.reduce((ae,re)=>ae+re.nota,0)/z.length},[n,h]=await Promise.all([d(t),d(i)]);O({artist:n,venue:h})},Y=async()=>{var i,d,n,h;E(!0),T([]);const a=Array.isArray(s.artistas)?(i=s.artistas[0])==null?void 0:i.usuario_id:(d=s.artistas)==null?void 0:d.usuario_id,t=Array.isArray(s.estabelecimentos)?(n=s.estabelecimentos[0])==null?void 0:n.usuario_id:(h=s.estabelecimentos)==null?void 0:h.usuario_id;if(!a||!t){E(!1);return}try{const{data:m}=await S.from("conversas").select("id").or(`and(participante_a.eq.${a},participante_b.eq.${t}),and(participante_a.eq.${t},participante_b.eq.${a})`).maybeSingle();if(m){const{data:v}=await S.from("mensagens").select("*").eq("conversa_id",m.id).order("criado_em",{ascending:!0});T(v||[])}}catch(m){console.error("Error fetching chat context",m)}finally{E(!1)}},ee=async()=>{if(M.current){u(!0);try{const a=(await X(async()=>{const{default:R}=await import("./html2canvas.esm-QH1iLAAe.js");return{default:R}},[])).default,{jsPDF:t}=await X(async()=>{const{jsPDF:R}=await import("./jspdf.es.min-D-5srVFd.js").then(k=>k.j);return{jsPDF:R}},__vite__mapDeps([0,1,2])),i=await a(M.current,{scale:2,useCORS:!0,backgroundColor:"#ffffff",windowWidth:1200}),d=i.toDataURL("image/png"),n=new t("p","mm","a4"),h=n.internal.pageSize.getWidth(),m=h/(i.width/i.height);let v=m,D=0;for(n.addImage(d,"PNG",0,D,h,m),v-=n.internal.pageSize.getHeight();v>0;)D=v-m,n.addPage(),n.addImage(d,"PNG",0,D,h,m),v-=n.internal.pageSize.getHeight();n.save(`admin-copy-${s.id.substring(0,8)}.pdf`),g({message:"PDF gerado com sucesso.",type:"success"})}catch(a){g({message:"Erro ao gerar PDF: "+I(a),type:"error"})}finally{u(!1)}}},se=async()=>{u(!0);try{const a={};A!==s.status&&(a.status=A,A==="concluido"&&!s.data_pagamento&&(a.data_pagamento=new Date().toISOString()));const t=parseFloat(y);if(!isNaN(t)&&t!==s.taxa_servico&&(a.taxa_servico=t),Object.keys(a).length===0){g({message:"Nenhuma alteração detectada.",type:"error"}),u(!1);return}const i=`

[INTERVENÇÃO MANUAL ADMIN em ${new Date().toLocaleString("pt-BR")}]: Status alterado de ${s.status} para ${A}.`;a.condicoes=(s.condicoes||"")+i;const{error:d}=await S.from("contratos").update(a).eq("id",s.id);if(d)throw d;g({message:"Contrato atualizado manualmente.",type:"success"}),b()}catch(a){g({message:`Erro: ${I(a)}`,type:"error"})}finally{u(!1)}},te=async()=>{if($.trim()){u(!0);try{const t=`

[PAGAMENTO MANUAL REGISTRADO em ${new Date().toLocaleString("pt-BR")}]: Ref: ${$}`,{error:i}=await S.from("contratos").update({status:"concluido",data_pagamento:new Date().toISOString(),condicoes:(s.condicoes||"")+t}).eq("id",s.id);if(i)throw i;g({message:"Pagamento manual registrado.",type:"success"}),q(""),b()}catch(a){g({message:`Erro: ${I(a)}`,type:"error"})}finally{u(!1)}}},V=async a=>{u(!0);try{const t=a==="refund"?"ESTORNO AUTORIZADO AO CONTRATANTE.":"PAGAMENTO LIBERADO AO ARTISTA.",i=new Date().toLocaleString("pt-BR"),d=(s.condicoes||"")+`

[ADMINISTRAÇÃO em ${i}]: ${t}`,{error:n}=await S.from("contratos").update({condicoes:d}).eq("id",s.id);if(n)throw n;g({message:`Disputa resolvida: ${a==="refund"?"Estorno":"Liberação"}.`,type:"success"}),b()}catch(t){g({message:`Erro: ${I(t)}`,type:"error"})}finally{u(!1)}},F=async(a,t)=>{u(!0);try{const i=a==="signature"?"Lembrete de Assinatura":"Lembrete de Pagamento",d=a==="signature"?`Você tem um contrato pendente de assinatura para o dia ${new Date(s.data_evento).toLocaleDateString()}.`:`O pagamento do contrato para o dia ${new Date(s.data_evento).toLocaleDateString()} está pendente.`;await ne.create({usuario_id:t,tipo:"sistema",titulo:i,descricao:d,url_destino:`/contratos/${s.id}`}),g({message:"Lembrete enviado.",type:"success"})}catch{g({message:"Erro ao enviar lembrete.",type:"error"})}finally{u(!1)}};return o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-50 flex justify-center items-center p-4 backdrop-blur-sm",onClick:l,children:e.jsxs("div",{className:"bg-gray-800 text-white rounded-xl shadow-2xl w-full max-w-4xl relative p-6 animate-fade-in border border-gray-700 max-h-[90vh] overflow-y-auto flex flex-col",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-start mb-6 pb-4 border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h2",{className:"text-2xl font-bold font-poppins",children:["Contrato #",s.id.substring(0,8)]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold uppercase ${s.status==="concluido"?"bg-green-500/20 text-green-300":"bg-gray-700 text-gray-300"}`,children:s.status})]}),e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:["Criado em ",new Date(s.criado_em).toLocaleDateString("pt-BR")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:ee,disabled:_,className:"flex items-center gap-1 bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded text-sm transition-colors",children:[e.jsx(ce,{className:"w-4 h-4"})," Baixar PDF"]}),e.jsx("button",{onClick:l,className:"text-gray-500 hover:text-white",children:e.jsx(ie,{})})]})]}),w&&e.jsx("div",{className:`p-3 rounded-md mb-6 text-center text-sm ${w.type==="success"?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-400"}`,children:w.message}),s.status==="cancelado"&&s.data_pagamento&&e.jsxs("div",{className:"mb-8 bg-red-900/20 border-2 border-red-500/50 p-6 rounded-lg relative overflow-hidden",children:[e.jsxs("h3",{className:"text-lg font-bold text-red-400 mb-2 flex items-center gap-2 relative z-10",children:[e.jsx(Z,{className:"w-5 h-5"})," Resolução de Disputa Financeira"]}),e.jsxs("p",{className:"text-gray-300 text-sm mb-4 relative z-10",children:["Valor retido em custódia: ",e.jsxs("strong",{children:["R$ ",(H=s.valor)==null?void 0:H.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),"."]}),e.jsxs("div",{className:"flex flex-wrap gap-4 relative z-10",children:[e.jsxs("button",{onClick:()=>V("refund"),disabled:_,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors disabled:opacity-50",children:[e.jsx(J,{className:"w-5 h-5"})," Autorizar Estorno"]}),e.jsxs("button",{onClick:()=>V("release"),disabled:_,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors disabled:opacity-50",children:[e.jsx(P,{className:"w-5 h-5"})," Forçar Pagamento"]})]})]}),e.jsxs("div",{className:"mb-8 relative",children:[e.jsx("div",{className:"absolute top-5 left-0 w-full h-1 bg-gray-700 -z-0"}),e.jsxs("div",{className:"flex justify-between items-center relative z-10",children:[e.jsx(L,{active:!0,completed:!0,icon:e.jsx(me,{className:"w-5 h-5"}),label:"Criado",date:s.criado_em}),e.jsx(U,{active:s.status!=="enviado"&&s.status!=="rascunho"}),e.jsx(L,{active:["assinado","concluido"].includes(s.status),completed:s.status==="assinado"||s.status==="concluido",icon:e.jsx(ue,{className:"w-5 h-5"}),label:"Assinado",date:s.data_assinatura_estabelecimento}),e.jsx(U,{active:!!s.data_pagamento}),e.jsx(L,{active:!!s.data_pagamento,completed:!!s.data_pagamento,icon:e.jsx(ge,{className:"w-5 h-5"}),label:"Pago",date:s.data_pagamento}),e.jsx(U,{active:s.status==="concluido"}),e.jsx(L,{active:s.status==="concluido",completed:s.status==="concluido"&&be(s.data_evento,s.status),icon:e.jsx(P,{className:"w-5 h-5"}),label:"Liberado",date:s.status==="concluido"?he(s.data_evento).toISOString():null})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg border border-gray-700 relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 border-b border-gray-700 pb-2",children:[e.jsx("h3",{className:"text-primary font-bold",children:"CONTRATADO (Artista)"}),e.jsx("div",{className:"flex text-yellow-400 text-xs",children:j.artist>0&&[...Array(5)].map((a,t)=>e.jsx(K,{className:`w-3 h-3 ${t<Math.round(j.artist)?"text-yellow-400":"text-gray-600"}`},t))})]}),(()=>{const a=Array.isArray(s.artistas)?s.artistas[0]:s.artistas,t=Array.isArray(a==null?void 0:a.usuarios)?a.usuarios[0]:a==null?void 0:a.usuarios;return e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 overflow-hidden",children:(t==null?void 0:t.foto_url)&&e.jsx("img",{src:S.storage.from("perfis").getPublicUrl(t.foto_url).data.publicUrl,className:"w-full h-full object-cover"})}),e.jsx("p",{className:"font-bold text-white text-lg",children:t==null?void 0:t.nome})]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-500",children:"Email:"})," ",(t==null?void 0:t.email)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-500",children:"Telefone:"})," ",(t==null?void 0:t.telefone)||"N/A"]}),!s.assinatura_artista&&s.status==="enviado"&&e.jsxs("button",{onClick:()=>(t==null?void 0:t.id)&&F("signature",t.id),className:"mt-2 w-full text-xs bg-orange-500/20 text-orange-300 border border-orange-500/30 px-2 py-1 rounded hover:bg-orange-500/30 transition-colors flex items-center justify-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"})," Cobrar Assinatura"]})]})})()]}),e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg border border-gray-700 relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 border-b border-gray-700 pb-2",children:[e.jsx("h3",{className:"text-secondary font-bold",children:"CONTRATANTE (Local)"}),e.jsx("div",{className:"flex text-yellow-400 text-xs",children:j.venue>0&&[...Array(5)].map((a,t)=>e.jsx(K,{className:`w-3 h-3 ${t<Math.round(j.venue)?"text-yellow-400":"text-gray-600"}`},t))})]}),(()=>{const a=Array.isArray(s.estabelecimentos)?s.estabelecimentos[0]:s.estabelecimentos,t=Array.isArray(a==null?void 0:a.usuarios)?a.usuarios[0]:a==null?void 0:a.usuarios;return e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 overflow-hidden",children:(t==null?void 0:t.foto_url)&&e.jsx("img",{src:S.storage.from("perfis").getPublicUrl(t.foto_url).data.publicUrl,className:"w-full h-full object-cover"})}),e.jsx("p",{className:"font-bold text-white text-lg",children:t==null?void 0:t.nome})]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-500",children:"Email:"})," ",(t==null?void 0:t.email)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-500",children:"Telefone:"})," ",(t==null?void 0:t.telefone)||"N/A"]}),!s.assinatura_estabelecimento&&s.status==="enviado"&&e.jsxs("button",{onClick:()=>(t==null?void 0:t.id)&&F("signature",t.id),className:"mt-2 w-full text-xs bg-purple-500/20 text-purple-300 border border-purple-500/30 px-2 py-1 rounded hover:bg-purple-500/30 transition-colors flex items-center justify-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"})," Cobrar Assinatura"]}),s.status==="assinado"&&!s.data_pagamento&&e.jsxs("button",{onClick:()=>(t==null?void 0:t.id)&&F("payment",t.id),className:"mt-2 w-full text-xs bg-yellow-500/20 text-yellow-300 border border-yellow-500/30 px-2 py-1 rounded hover:bg-yellow-500/30 transition-colors flex items-center justify-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"})," Cobrar Pagamento"]})]})})()]})]}),e.jsxs("div",{className:"flex border-b border-gray-700 mb-4 overflow-x-auto",children:[e.jsx("button",{onClick:()=>p("info"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors whitespace-nowrap ${x==="info"?"border-primary text-white":"border-transparent text-gray-400 hover:text-gray-300"}`,children:"Termos"}),e.jsx("button",{onClick:()=>p("audit"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors whitespace-nowrap ${x==="audit"?"border-primary text-white":"border-transparent text-gray-400 hover:text-gray-300"}`,children:"Auditoria"}),e.jsxs("button",{onClick:()=>{p("chat"),Y()},className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors whitespace-nowrap flex items-center gap-2 ${x==="chat"?"border-primary text-white":"border-transparent text-gray-400 hover:text-gray-300"}`,children:[e.jsx(pe,{className:"w-4 h-4"})," Chat"]}),e.jsx("button",{onClick:()=>p("diagnosis"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors whitespace-nowrap ${x==="diagnosis"?"border-primary text-white":"border-transparent text-gray-400 hover:text-gray-300"}`,children:"Diagnóstico"})]}),e.jsx("div",{className:"bg-gray-900 p-4 rounded-lg border border-gray-700 flex-grow mb-6 max-h-64 overflow-y-auto",children:(()=>{const{terms:a,logs:t}=fe(s.condicoes);if(x==="info")return e.jsx("div",{className:"whitespace-pre-wrap text-sm text-gray-300",children:a||"Nenhuma condição adicional."});if(x==="audit")return e.jsx("div",{className:"space-y-4",children:t.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"Sem registros."}):t.map((i,d)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full mt-1.5"}),e.jsx("div",{className:"w-px h-full bg-gray-700 my-1"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase",children:i.header}),e.jsx("p",{className:"text-sm text-gray-300",children:i.message})]})]},d))});if(x==="diagnosis"){const i=ye(s);let d="text-green-400";return i.riskScore>30&&(d="text-yellow-400"),i.riskScore>60&&(d="text-red-400"),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-800 p-3 rounded",children:[e.jsx("span",{className:"text-sm font-bold text-gray-300",children:"Risco Automático"}),e.jsxs("span",{className:`text-xl font-bold ${d}`,children:[i.riskScore,"/100"]})]}),e.jsx("div",{className:"space-y-3",children:i.checks.map((n,h)=>e.jsxs("div",{className:`p-3 rounded border flex items-center gap-3 ${n.status==="ok"?"bg-green-900/20 border-green-900/50":n.status==="warning"?"bg-yellow-900/20 border-yellow-900/50":"bg-red-900/20 border-red-900/50"}`,children:[n.status==="ok"&&e.jsx(P,{className:"w-5 h-5 text-green-500"}),n.status==="warning"&&e.jsx(Z,{className:"w-5 h-5 text-yellow-500"}),n.status==="error"&&e.jsx(J,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:n.text})]},h))})]})}if(x==="chat")return C?e.jsx("p",{className:"text-center text-gray-500",children:"Carregando..."}):f.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"Sem histórico."}):e.jsx("div",{className:"space-y-3",children:f.map(i=>{var h,m;const d=Array.isArray(s.artistas)?(h=s.artistas[0])==null?void 0:h.usuario_id:(m=s.artistas)==null?void 0:m.usuario_id,n=i.remetente_id===d;return e.jsxs("div",{className:`flex flex-col ${n?"items-end":"items-start"}`,children:[e.jsx("div",{className:`max-w-[80%] p-3 rounded-lg text-sm ${n?"bg-primary/20 text-primary-100 rounded-tr-none":"bg-gray-700 text-gray-200 rounded-tl-none"}`,children:i.texto}),e.jsxs("span",{className:"text-[10px] text-gray-500 mt-1",children:[n?"Artista":"Local"," • ",new Date(i.criado_em).toLocaleString()]})]},i.id)})})})()}),e.jsx("div",{className:"hidden",children:e.jsxs("div",{ref:M,className:"pdf-content p-10 bg-white text-black font-serif",style:{width:"800px"},children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-6",children:"CONTRATO DE SERVIÇOS"}),e.jsxs("p",{className:"mb-4",children:[e.jsx("strong",{children:"ID:"})," #",s.id]}),e.jsxs("p",{className:"mb-4",children:[e.jsx("strong",{children:"Evento:"})," ",new Date(s.data_evento).toLocaleDateString()]}),e.jsx("div",{className:"whitespace-pre-wrap",children:s.condicoes})]})}),e.jsxs("div",{className:"mt-8 bg-gray-900 border border-gray-600 p-4 rounded-lg",children:[e.jsxs("h3",{className:"text-gray-400 text-xs uppercase font-bold mb-3 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"})," Intervenção Manual"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3 p-3 border border-gray-700 rounded bg-gray-800/50",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase",children:"Alterar Dados"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"text-[10px] text-gray-500 block mb-1",children:"Status"}),e.jsxs("select",{value:A,onChange:a=>r(a.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded p-1.5 text-xs text-white",children:[e.jsx("option",{value:"enviado",children:"Aguardando"}),e.jsx("option",{value:"assinado",children:"Assinado"}),e.jsx("option",{value:"concluido",children:"Concluído"}),e.jsx("option",{value:"cancelado",children:"Cancelado"}),e.jsx("option",{value:"rascunho",children:"Rascunho"})]})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"text-[10px] text-gray-500 block mb-1",children:"Taxa (R$)"}),e.jsx("input",{type:"number",value:y,onChange:a=>N(a.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded p-1.5 text-xs text-white"})]})]}),e.jsx("button",{onClick:se,disabled:_,className:"w-full bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-bold py-1.5 px-3 rounded transition-colors disabled:opacity-50",children:"Aplicar"})]}),e.jsxs("div",{className:"space-y-3 p-3 border border-gray-700 rounded bg-gray-800/50",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase",children:"Pagamento Externo"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ref (ex: TED #1234)",value:$,onChange:a=>q(a.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded p-1.5 text-xs text-white"}),e.jsx("button",{onClick:te,disabled:_||!$.trim(),className:"whitespace-nowrap bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1.5 px-3 rounded transition-colors disabled:opacity-50",children:"Registrar"})]})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:l,className:"px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded font-medium transition-colors",children:"Fechar"})})]})}):null},Le=()=>{const[o,l]=c.useState([]),[s,b]=c.useState(!0),[x,p]=c.useState(null),[f,T]=c.useState(""),[C,E]=c.useState("all"),[_,u]=c.useState(!1),[w,g]=c.useState(null),j=c.useCallback(async()=>{b(!0),p(null);try{let r=S.from("contratos").select(`
                    *, 
                    artistas(usuario_id, usuarios(nome)), 
                    estabelecimentos(usuario_id, usuarios(nome))
                `).order("criado_em",{ascending:!1});C!=="all"&&(r=r.eq("status",C)),f&&f.match(/^[0-9a-f]{8}-/)&&(r=r.eq("id",f));const{data:y,error:N}=await r;if(N)throw N;l(y)}catch(r){p(I(r))}finally{b(!1)}},[f,C]);c.useEffect(()=>{j()},[j]);const O=r=>{g(r),u(!0)},A=r=>{const y=Array.isArray(r)?r[0]:r;if(!y)return"Desconhecido";const N=Array.isArray(y.usuarios)?y.usuarios[0]:y.usuarios;return(N==null?void 0:N.nome)||"Desconhecido"};return e.jsxs("div",{className:"text-white animate-fade-in",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-primary font-poppins",children:"Gestão de Contratos"}),e.jsx("p",{className:"text-gray-400 mb-8",children:"Monitore e audite todos os contratos gerados na plataforma."}),e.jsxs("div",{className:"bg-gray-800 p-5 rounded-xl mb-8 border border-gray-700 shadow-md flex flex-col lg:flex-row items-center gap-4",children:[e.jsxs("div",{className:"relative flex-grow w-full lg:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Buscar por ID exato (UUID)...",value:f,onChange:r=>T(r.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-primary text-white"}),e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"})]}),e.jsx("div",{className:"flex items-center gap-2 w-full lg:w-auto",children:e.jsxs("select",{value:C,onChange:r=>E(r.target.value),className:"bg-gray-900 border border-gray-600 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-primary text-white w-full lg:w-auto",children:[e.jsx("option",{value:"all",children:"Todos os Status"}),e.jsx("option",{value:"rascunho",children:"Rascunho"}),e.jsx("option",{value:"enviado",children:"Aguardando Assinatura"}),e.jsx("option",{value:"assinado",children:"Assinado"}),e.jsx("option",{value:"concluido",children:"Concluído (Pago)"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})}),e.jsx("button",{onClick:j,className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors",children:"Atualizar"})]}),x&&e.jsx("div",{className:"bg-red-500/20 text-red-400 p-4 rounded-lg mb-6 border border-red-500/30 text-center",children:x}),e.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-900 text-gray-400 text-xs uppercase font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"ID"}),e.jsx("th",{className:"p-4",children:"Artista"}),e.jsx("th",{className:"p-4",children:"Contratante"}),e.jsx("th",{className:"p-4",children:"Data Evento"}),e.jsx("th",{className:"p-4 text-right",children:"Valor"}),e.jsx("th",{className:"p-4 text-center",children:"Status"}),e.jsx("th",{className:"p-4 text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700 text-sm",children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-8 text-center text-gray-500",children:"Carregando contratos..."})}):o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-8 text-center text-gray-500",children:"Nenhum contrato encontrado."})}):o.map(r=>{var y;return e.jsxs("tr",{className:"hover:bg-gray-700/30 transition-colors",children:[e.jsxs("td",{className:"p-4 font-mono text-xs text-gray-500",title:r.id,children:[r.id.substring(0,8),"..."]}),e.jsx("td",{className:"p-4 font-medium text-white",children:A(r.artistas)}),e.jsx("td",{className:"p-4 text-gray-300",children:A(r.estabelecimentos)}),e.jsx("td",{className:"p-4 text-gray-300",children:new Date(r.data_evento).toLocaleDateString()}),e.jsxs("td",{className:"p-4 text-right font-mono",children:["R$ ",((y=r.valor)==null?void 0:y.toLocaleString("pt-BR",{minimumFractionDigits:2}))||"0,00"]}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase 
                                                ${r.status==="concluido"?"bg-green-500/20 text-green-300":r.status==="cancelado"?"bg-red-500/20 text-red-300":r.status==="assinado"?"bg-blue-500/20 text-blue-300":"bg-yellow-500/20 text-yellow-300"}`,children:r.status})}),e.jsx("td",{className:"p-4 text-right",children:e.jsx("button",{onClick:()=>O(r),className:"p-2 text-blue-400 hover:text-white hover:bg-blue-600/20 rounded transition-colors",title:"Auditar Contrato",children:e.jsx(de,{className:"w-5 h-5"})})})]},r.id)})})]})})}),w&&e.jsx(je,{isOpen:_,onClose:()=>u(!1),contract:w,onRefresh:j})]})};export{Le as default};
