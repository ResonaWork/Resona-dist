import{j as e,b as j,e as m,a as N}from"./index-Cc-Lnn9x.js";import{r as l}from"./vendor-react-Dfcn4nkY.js";import{S as M}from"./SearchIcon-DH3o1suK.js";import{U as R}from"./UserCircleIcon-DFsE5r8q.js";import{C as v}from"./CheckCircleIcon-DMttEdVL.js";import{X as L}from"./XCircleIcon-D5u5_z3n.js";import{T as z}from"./TrophyIcon-Z6L4xw3A.js";import{C as P}from"./ConfirmationModal-FOR2G1eE.js";import"./vendor-jspdf-Bh_S0msn.js";import"./vendor-utils-DmyZJLyO.js";import"./vendor-ui-DKtFGipk.js";import"./ExclamationIcon-CXRxAwkS.js";const $=({className:n="w-6 h-6"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:n,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2 4l3 12h14l3-12-6 7-4-7-4 7-6-7zM5 20h14"})}),Q=()=>{const[n,i]=l.useState([]),[y,h]=l.useState(!0),[F,u]=l.useState(null),[c,k]=l.useState(""),[d,C]=l.useState("all"),[x,A]=l.useState("all"),[t,g]=l.useState(null),[S,p]=l.useState(!1),[E,b]=l.useState(!1),f=async()=>{h(!0),u(null);try{let a=j.from("usuarios").select(`
                    *,
                    artista:artistas(id),
                    estabelecimento:estabelecimentos(id)
                `).order("criado_em",{ascending:!1});const{data:r,error:s}=await a;if(s)throw s;i((r||[]).map(o=>({...o,artista:Array.isArray(o.artista)?o.artista[0]:o.artista,estabelecimento:Array.isArray(o.estabelecimento)?o.estabelecimento[0]:o.estabelecimento})))}catch(a){u(m(a))}finally{h(!1)}};l.useEffect(()=>{f()},[]);const w=n.filter(a=>{const r=a.nome.toLowerCase().includes(c.toLowerCase())||a.email.toLowerCase().includes(c.toLowerCase()),s=d==="all"||a.role===d,o=x==="all"||a.tipo===x;return r&&s&&o}),I=async()=>{if(t){b(!0);try{const a=t.role==="banned"?"user":"banned";await N.updateBasicInfo(t.id,{role:a}),i(r=>r.map(s=>s.id===t.id?{...s,role:a}:s)),p(!1),g(null)}catch(a){alert("Erro ao atualizar usuário: "+m(a))}finally{b(!1)}}},T=async(a,r)=>{if(window.confirm(`Tem certeza que deseja alterar o nível de acesso de ${a.nome} para ${r}?`))try{await N.updateBasicInfo(a.id,{role:r}),i(s=>s.map(o=>o.id===a.id?{...o,role:r}:o))}catch(s){alert("Erro: "+m(s))}},B=a=>{const r=a.plano;if(!r||r==="free")return e.jsx("span",{className:"text-gray-600 text-[10px] font-black uppercase tracking-widest",children:"Gratuito"});let s="text-blue-300 bg-blue-500/10 border-blue-500/30";return r==="business"&&(s="text-yellow-300 bg-yellow-500/10 border-yellow-500/30"),r==="pro"&&(s="text-primary bg-primary/10 border-primary/30"),e.jsxs("span",{className:`px-2 py-0.5 rounded text-[10px] font-black uppercase border flex items-center gap-1 w-fit ${s}`,children:[(r==="business"||r==="pro")&&e.jsx($,{className:"w-3 h-3"}),r.toUpperCase()]})};return e.jsxs("div",{className:"text-white animate-fade-in pb-12",children:[e.jsxs("div",{className:"flex flex-col mb-12",children:[e.jsxs("h1",{className:"text-heading-hero mb-3 uppercase",children:["COFRE DE ",e.jsx("span",{className:"text-primary italic",children:"USUÁRIOS"})]}),e.jsx("p",{className:"text-section-label text-gray-500",children:"Controle de Acesso e Gestão de Membros"})]}),e.jsxs("div",{className:"glass-card p-6 rounded-3xl mb-12 border-white/5 shadow-2xl flex flex-col xl:flex-row items-center gap-6 group",children:[e.jsxs("div",{className:"relative flex-grow w-full xl:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Escanear identidades (Nome ou Email)...",value:c,onChange:a=>k(a.target.value),className:"w-full bg-white/5 border border-white/10 rounded-xl py-4 pl-12 pr-6 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white font-medium transition-all group-hover:bg-white/[0.08]"}),e.jsx(M,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"})]}),e.jsxs("div",{className:"flex gap-4 w-full xl:w-auto overflow-x-auto",children:[e.jsxs("select",{value:x,onChange:a=>A(a.target.value),className:"bg-white/5 border border-white/10 rounded-xl py-4 px-6 text-[10px] font-black uppercase tracking-widest focus:outline-none focus:ring-2 focus:ring-primary/50 text-white cursor-pointer hover:bg-white/10 transition-all",children:[e.jsx("option",{value:"all",className:"bg-dark",children:"Classificação: Todos"}),e.jsx("option",{value:"artista",className:"bg-dark",children:"Classificação: Artista"}),e.jsx("option",{value:"estabelecimento",className:"bg-dark",children:"Classificação: Estabelecimento"})]}),e.jsxs("select",{value:d,onChange:a=>C(a.target.value),className:"bg-white/5 border border-white/10 rounded-xl py-4 px-6 text-[10px] font-black uppercase tracking-widest focus:outline-none focus:ring-2 focus:ring-primary/50 text-white cursor-pointer hover:bg-white/10 transition-all",children:[e.jsx("option",{value:"all",className:"bg-dark",children:"Acesso: Todos"}),e.jsx("option",{value:"user",className:"bg-dark",children:"Acesso: Padrão"}),e.jsx("option",{value:"moderador",className:"bg-dark",children:"Acesso: Moderador"}),e.jsx("option",{value:"admin",className:"bg-dark",children:"Acesso: Administrador"}),e.jsx("option",{value:"admin-master",className:"bg-dark",children:"Acesso: Master"}),e.jsx("option",{value:"banned",className:"bg-dark",children:"Acesso: Banido"})]})]}),e.jsx("button",{onClick:f,className:"bg-white/5 hover:bg-white/10 text-white text-[10px] font-black uppercase tracking-widest px-8 py-4 rounded-xl border border-white/10 transition-all active:scale-95 whitespace-nowrap shadow-lg",children:"Atualizar Inventário"})]}),e.jsx("div",{className:"glass-card rounded-3xl border-white/5 overflow-hidden shadow-2xl",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-white/5 text-section-label text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-6 pl-10",children:"Identidade da Entidade"}),e.jsx("th",{className:"p-6 text-center",children:"Classe"}),e.jsx("th",{className:"p-6 text-center",children:"Nível Protocolo"}),e.jsx("th",{className:"p-6 text-center",children:"Status Vital"}),e.jsx("th",{className:"p-6 text-center",children:"Sobrescrita Acesso"}),e.jsx("th",{className:"p-6 text-right pr-10",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-white/[0.02]",children:y?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-24 text-center text-gray-600 font-black uppercase tracking-widest animate-pulse",children:"Sincronizando Cofre..."})}):w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-24 text-center text-gray-600 font-black uppercase tracking-widest",children:"Nenhum resultado encontrado nesta frequência."})}):w.map(a=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors group",children:[e.jsx("td",{className:"p-6 pl-10",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/5 border border-white/10 flex-shrink-0 overflow-hidden group-hover:border-primary/50 transition-all",children:a.foto_url?e.jsx("img",{src:j.storage.from("perfis").getPublicUrl(a.foto_url).data.publicUrl,className:"w-full h-full object-cover"}):e.jsx(R,{className:"w-full h-full text-gray-600 p-2.5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-black text-white font-poppins tracking-tight truncate max-w-[220px] uppercase leading-tight",children:a.nome}),e.jsx("p",{className:"text-[11px] font-mono text-gray-500 truncate max-w-[200px]",children:a.email})]})]})}),e.jsx("td",{className:"p-6 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest ${a.tipo==="artista"?"bg-purple-500/10 text-purple-400 border border-purple-500/20":"bg-orange-500/10 text-orange-400 border border-orange-500/20"}`,children:a.tipo})}),e.jsx("td",{className:"p-6 text-center flex justify-center",children:B(a)}),e.jsx("td",{className:"p-6 text-center",children:a.status_verificacao==="verificado"?e.jsxs("span",{className:"inline-flex items-center gap-2 text-green-400 text-[10px] font-black uppercase tracking-widest",children:[e.jsx(v,{className:"w-4 h-4"})," Verificado"]}):a.status_verificacao==="pendente"?e.jsxs("span",{className:"inline-flex items-center gap-2 text-yellow-500 text-[10px] font-black uppercase tracking-widest",children:[e.jsx(z,{className:"w-4 h-4"})," Revisar"]}):e.jsx("span",{className:"text-gray-600 text-[10px] font-black uppercase tracking-widest",children:"Não Verificado"})}),e.jsx("td",{className:"p-6 text-center",children:e.jsxs("select",{value:a.role||"user",onChange:r=>T(a,r.target.value),className:`bg-white/5 border border-white/5 rounded-full px-4 py-2 text-[9px] font-black uppercase tracking-tighter cursor-pointer focus:outline-none transition-all ${a.role==="admin-master"?"text-red-400 border-red-500/30":a.role==="admin"?"text-red-300 border-red-500/20":"text-gray-400 hover:text-white"}`,children:[e.jsx("option",{value:"user",className:"bg-dark",children:"Padrão"}),e.jsx("option",{value:"moderador",className:"bg-dark",children:"Moderador"}),e.jsx("option",{value:"admin",className:"bg-dark",children:"Administrador"}),e.jsx("option",{value:"admin-master",className:"bg-dark",children:"Chave Master"}),e.jsx("option",{value:"banned",className:"bg-dark",children:"Banido"})]})}),e.jsx("td",{className:"p-6 text-right pr-10",children:e.jsx("button",{onClick:()=>{g(a),p(!0)},className:`w-10 h-10 flex items-center justify-center rounded-xl transition-all ml-auto ${a.role==="banned"?"bg-green-500/10 text-green-400 hover:bg-green-500 hover:text-dark":"bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white border border-red-500/20"}`,title:a.role==="banned"?"Restaurar Acesso":"Restringir Acesso",children:a.role==="banned"?e.jsx(v,{className:"w-5 h-5"}):e.jsx(L,{className:"w-5 h-5"})})})]},a.id))})]})})}),e.jsx(P,{isOpen:S,onClose:()=>p(!1),onConfirm:I,title:(t==null?void 0:t.role)==="banned"?"Reativar Conta":"Banir Usuário",message:e.jsxs("p",{children:["Tem certeza que deseja ",(t==null?void 0:t.role)==="banned"?"reativar":"banir"," o acesso de ",e.jsx("strong",{children:t==null?void 0:t.nome})," da plataforma?"]}),confirmText:(t==null?void 0:t.role)==="banned"?"Reativar":"Banir",isConfirming:E,variant:(t==null?void 0:t.role)==="banned"?"success":"danger"})]})};export{Q as default};
