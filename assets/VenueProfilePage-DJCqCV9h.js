import{x as de,h as me,a as xe,r,j as e,L as V,s as m,d as B,y as pe,e as G,m as he}from"./index-v9YSdgyP.js";import{M as z}from"./MapPinIcon-9bzNHoel.js";import{U as J}from"./UsersIcon-CO7cMPkf.js";import{P as ge}from"./PhotographIcon-D8jVlDNv.js";import{i as j}from"./ChevronLeftIcon-CI9PxyOd.js";import{C as fe,R as ue}from"./ReviewList-a1bgRydT.js";import{S as be,I as je}from"./ShareIcon-BZgSoXnl.js";import{C as ye}from"./CheckCircleIcon-Cv8yAk67.js";import{S as ve}from"./SEO-DGLMjagV.js";import"./StarIcon-z084WkeF.js";import"./UserCircleIcon-CmcgnTZY.js";import"./EmptyState-DMrGfkUw.js";import"./ChevronRightIcon-BrCn-GTD.js";const Le=()=>{var I,U,_,E,$,A,D,L;const{id:x}=de(),{profile:o,user:Z}=me(),y=xe(),[s,F]=r.useState(null),[v,H]=r.useState([]),[p,K]=r.useState([]),[N,Q]=r.useState([]),[w,W]=r.useState(null),[X,h]=r.useState(!0),[Y,g]=r.useState(null),[ee,S]=r.useState(!1),[se,f]=r.useState(""),[C,P]=r.useState(!1),[te,k]=r.useState(!1),[ae,re]=r.useState(0);r.useEffect(()=>{(async()=>{var i,O;if(!x){g("ID não fornecido."),h(!1);return}h(!0),g(null);try{const{data:d,error:le}=await B.from("usuarios").select("*, estabelecimento:estabelecimentos!inner(*)").eq("id",x).eq("tipo","estabelecimento").single();if(le||!d)throw new Error("Perfil não encontrado.");const q=pe(d),t=q.estabelecimento;if(t!=null&&t.id){const{data:l}=await B.from("contratos").select("id, data_evento, artistas!inner(usuario_id, usuarios!inner(nome))").eq("estabelecimento_id",t.id).in("status",["assinado","concluido"]).lte("data_evento",new Date().toISOString()).order("data_evento",{ascending:!1});H((l||[]).map(n=>{const c=Array.isArray(n.artistas)?n.artistas[0]:n.artistas,b=c&&(Array.isArray(c.usuarios)?c.usuarios[0]:c.usuarios);return!c||!b?null:{id:n.id,titulo:`Show com ${b.nome}`,data_evento:n.data_evento,artista:{id:c.usuario_id,nome:b.nome}}}).filter(n=>n!==null))}const R=Date.now(),M=((i=t==null?void 0:t.galeria_fotos)==null?void 0:i.filter(l=>!!l))||[],T=((O=t==null?void 0:t.galeria_videos)==null?void 0:O.filter(l=>!!l))||[],[ne,ce]=await Promise.all([M.length>0?m.getSignedUrls("estabelecimento",M,3600):Promise.resolve([]),T.length>0?m.getSignedUrls("estabelecimento",T,3600):Promise.resolve([])]);K(ne.map(l=>`${l}&t=${R}`)),Q(ce),t!=null&&t.foto_capa&&W(`${m.getPublicUrl("estabelecimento",t.foto_capa)}?t=${R}`),F(q)}catch(d){g(G(d))}finally{h(!1)}})()},[x]);const oe=async a=>{S(!0),f("");try{if(!Z){y("/login");return}if(!o)throw new Error("Perfil não carregado.");await he.startConversation(o.id,a.id,`Olá, somos do ${o.nome}!`),f("Conversa iniciada!"),setTimeout(()=>{y("/painel?open=mensagens")},1500)}catch(i){f(G(i))}finally{S(!1)}};if(X)return e.jsx("div",{className:"flex justify-center items-center h-screen bg-dark text-white",children:"Carregando..."});if(Y||!s)return e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen bg-dark text-red-500",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Perfil não encontrado"}),e.jsx(V,{to:"/estabelecimentos",className:"mt-4 text-primary underline",children:"Voltar"})]});const u=s.foto_url?`${m.getPublicUrl("perfis",s.foto_url)}?t=${Date.now()}`:"https://images.unsplash.com/photo-1550966871-3ed3cdb5ed0c?q=80&w=2070&auto=format&fit=crop",ie={"@context":"https://schema.org","@type":"EntertainmentBusiness",name:s.nome,description:((I=s.estabelecimento)==null?void 0:I.descricao)||"",image:u,address:{"@type":"PostalAddress",streetAddress:((U=s.estabelecimento)==null?void 0:U.endereco)||"",addressLocality:s.cidade,addressCountry:"BR"}};return e.jsxs("div",{className:"bg-dark text-white font-sans min-h-screen pb-24 lg:pb-0 relative",children:[e.jsx(ve,{title:s.nome,description:((E=(_=s.estabelecimento)==null?void 0:_.descricao)==null?void 0:E.substring(0,160))||`Confira o perfil de ${s.nome} no Resona. O lugar ideal para shows e eventos.`,image:u,type:"profile",schema:ie}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-[45vh] md:h-[55vh] bg-cover bg-center relative",style:{backgroundImage:w?`url(${w})`:"linear-gradient(to right, #1f2937, #111827)"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-dark via-dark/60 to-transparent"})}),e.jsx("div",{className:"container mx-auto px-4 relative -mt-32 md:-mt-40 z-10",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-end gap-6",children:[e.jsx("img",{src:u,alt:s.nome,className:"w-40 h-40 md:w-56 md:h-56 rounded-full object-cover border-4 border-dark shadow-2xl bg-gray-800 relative z-10"}),e.jsxs("div",{className:"flex-grow mb-2 text-center md:text-left",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-6xl font-black font-poppins flex items-center justify-center md:justify-start gap-3",children:[s.nome,s.plano!=="free"&&e.jsx(ye,{className:"w-6 h-6 md:w-8 md:h-8 text-primary shadow-primary/50"})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-4 mt-3",children:[(($=s.estabelecimento)==null?void 0:$.capacidade)&&e.jsxs("span",{className:"bg-secondary/20 backdrop-blur-md border border-secondary/30 text-secondary px-3 py-1 rounded-full text-sm font-bold flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"})," ",s.estabelecimento.capacidade," Pessoas"]}),e.jsxs("div",{className:"flex items-center text-gray-200 text-sm font-medium",children:[e.jsx(z,{className:"w-4 h-4 mr-1 text-primary"}),e.jsx("span",{children:s.cidade||"Brasil"})]})]})]}),e.jsxs("div",{className:"mb-4 md:mb-8 flex flex-col sm:flex-row gap-3 w-full md:w-auto justify-center",children:[e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(window.location.href),P(!0),setTimeout(()=>P(!1),2e3)},className:"bg-gray-800/80 px-5 py-2.5 rounded-full border border-gray-600 shadow-lg flex items-center justify-center gap-2 text-sm",children:[C?e.jsx(fe,{className:"w-5 h-5 text-green-400"}):e.jsx(be,{className:"w-5 h-5"}),C?"Copiado!":"Compartilhar"]}),(o==null?void 0:o.tipo)==="artista"&&e.jsx("button",{onClick:()=>oe(s),disabled:ee||!j(o).complete,className:`font-bold py-2.5 px-8 rounded-full shadow-lg transform transition-all text-sm ${j(o).complete?"bg-gradient-to-r from-primary to-secondary text-white hover:scale-105":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,title:j(o).complete?"Enviar Mensagem":"Complete seu perfil de artista para enviar mensagens.",children:se||"Enviar Mensagem"})]})]})})]}),e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-10",children:[e.jsxs("section",{className:"bg-gray-800/50 p-8 rounded-2xl border border-gray-700/50 shadow-xl",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins mb-4",children:"Sobre o Local"}),e.jsx("p",{className:"text-gray-300 leading-relaxed text-lg whitespace-pre-wrap",children:((A=s.estabelecimento)==null?void 0:A.descricao)||"Sem descrição detalhada."})]}),e.jsxs("section",{className:"bg-gray-800/50 p-8 rounded-2xl border border-gray-700/50 shadow-xl",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins mb-6",children:"Já tocou aqui"}),v.length>0?e.jsx("div",{className:"space-y-3",children:v.map(a=>e.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-xl border border-gray-700 flex items-center gap-4",children:[e.jsxs("div",{className:"bg-gray-800 p-3 rounded-lg text-center min-w-[60px]",children:[e.jsx("span",{className:"block text-xs text-secondary font-bold uppercase",children:new Date(a.data_evento).toLocaleString("pt-BR",{month:"short",timeZone:"UTC"})}),e.jsx("span",{className:"block text-xl font-black text-white",children:new Date(a.data_evento).getUTCDate()})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white text-lg",children:a.titulo}),e.jsxs(V,{to:`/artista/${a.artista.id}`,className:"text-sm text-secondary hover:underline",children:["Com ",a.artista.nome]})]})]},a.id))}):e.jsx("div",{className:"text-center py-8 text-gray-500 italic",children:"Nenhum evento passado registrado."})]}),e.jsxs("section",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins",children:"Galeria"}),p.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:p.map((a,i)=>e.jsxs("div",{onClick:()=>{re(i),k(!0)},className:"cursor-pointer group relative overflow-hidden rounded-xl aspect-square",children:[e.jsx("img",{src:a,alt:"Galeria",className:"w-full h-full object-cover transition-transform group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx(ge,{className:"w-8 h-8"})})]},i))}):e.jsx("p",{className:"text-gray-500 italic",children:"Sem fotos disponíveis."})]}),N.length>0&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins",children:"Vídeos do Local"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:N.map((a,i)=>e.jsx("div",{className:"bg-gray-900 rounded-xl overflow-hidden border border-gray-700 shadow-lg group hover:border-secondary/50 transition-colors",children:e.jsx("video",{controls:!0,className:"w-full aspect-video object-cover bg-black",src:a,preload:"metadata"})},i))})]}),e.jsxs("section",{className:"pt-8 border-t border-gray-800",children:[e.jsx("h2",{className:"text-2xl font-bold font-poppins mb-8",children:"Avaliações"}),e.jsx(ue,{targetId:s.id})]})]}),e.jsx("aside",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700 sticky top-24",children:[e.jsx("h2",{className:"text-xl font-bold font-poppins mb-6 border-b border-gray-700 pb-2",children:"Informações"}),e.jsxs("div",{className:"space-y-4",children:[((D=s.estabelecimento)==null?void 0:D.endereco)&&e.jsxs("div",{className:"flex items-start p-3 bg-gray-900/50 rounded-lg",children:[e.jsx(z,{className:"w-5 h-5 mr-3 text-primary mt-0.5"}),e.jsx("span",{className:"text-gray-300 text-sm",children:s.estabelecimento.endereco})]}),((L=s.estabelecimento)==null?void 0:L.capacidade)&&e.jsxs("div",{className:"flex items-center p-3 bg-gray-900/50 rounded-lg",children:[e.jsx(J,{className:"w-5 h-5 mr-3 text-secondary"}),e.jsxs("span",{className:"text-gray-300 text-sm",children:["Capacidade: ",e.jsx("strong",{children:s.estabelecimento.capacidade})]})]}),s.email&&e.jsxs("div",{className:"pt-4 border-t border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase font-bold mb-1",children:"Contato Email"}),e.jsx("a",{href:`mailto:${s.email}`,className:"text-primary hover:underline font-mono text-sm break-all",children:s.email})]})]})]})})]})}),e.jsx(je,{isOpen:te,images:p,initialIndex:ae,onClose:()=>k(!1)})]})};export{Le as default};
