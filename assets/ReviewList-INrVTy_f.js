import{j as e,r as d,d as v,e as S}from"./index-COZr6oUa.js";import{S as x}from"./StarIcon-Ch2sh94e.js";import{U as _}from"./UserCircleIcon-CmCTjQsR.js";import{E}from"./EmptyState-DL1pPdG5.js";const A=({className:i="w-6 h-6"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:i,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),$=({targetId:i})=>{const[m,p]=d.useState([]),[y,g]=d.useState(!0),[u,j]=d.useState(""),[l,f]=d.useState({average:0,total:0,distribution:[0,0,0,0,0]});d.useEffect(()=>{(async()=>{if(i){g(!0);try{const{data:r,error:o}=await v.from("avaliacoes").select(`
                        id,
                        nota,
                        comentario,
                        criado_em,
                        avaliador:usuarios!avaliador_id (
                            id,
                            nome,
                            foto_url
                        )
                    `).eq("alvo_id",i).order("criado_em",{ascending:!1});if(o)throw o;const t=(r||[]).map(s=>({id:s.id,nota:s.nota,comentario:s.comentario,criado_em:s.criado_em,avaliador:Array.isArray(s.avaliador)?s.avaliador[0]:s.avaliador}));if(p(t),t.length>0){const s=t.length,c=t.reduce((n,w)=>n+w.nota,0)/s,h=[0,0,0,0,0];t.forEach(n=>{n.nota>=1&&n.nota<=5&&h[5-n.nota]++}),f({average:c,total:s,distribution:h})}else f({average:0,total:0,distribution:[0,0,0,0,0]})}catch(r){j("Erro ao carregar avaliações."),console.error(S(r))}finally{g(!1)}}})()},[i]);const b=a=>{if(a){const{data:r}=v.storage.from("perfis").getPublicUrl(a);return`${r.publicUrl}?t=${new Date().getTime()}`}return null};return y?e.jsxs("div",{className:"space-y-4 animate-pulse",children:[e.jsx("div",{className:"h-32 bg-gray-800 rounded-lg"}),e.jsx("div",{className:"h-24 bg-gray-800 rounded-lg"}),e.jsx("div",{className:"h-24 bg-gray-800 rounded-lg"})]}):u?e.jsx("div",{className:"text-center py-4 text-red-400 bg-red-500/10 rounded-lg border border-red-500/20",children:u}):e.jsx("div",{className:"space-y-8",children:m.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg flex flex-col md:flex-row gap-8 items-center",children:[e.jsxs("div",{className:"text-center md:text-left flex flex-col items-center md:items-start min-w-[150px]",children:[e.jsx("div",{className:"text-5xl font-extrabold text-white font-poppins",children:l.average.toFixed(1)}),e.jsx("div",{className:"flex text-yellow-400 my-2",children:[...Array(5)].map((a,r)=>e.jsx(x,{className:`w-5 h-5 ${r<Math.round(l.average)?"fill-current":"text-gray-600"}`},r))}),e.jsxs("p",{className:"text-sm text-gray-400",children:[l.total," ",l.total===1?"avaliação":"avaliações"]})]}),e.jsx("div",{className:"flex-grow w-full space-y-2",children:l.distribution.map((a,r)=>{const o=5-r,t=l.total>0?a/l.total*100:0;return e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center w-8 text-gray-400 font-bold",children:[o," ",e.jsx("span",{className:"text-[10px] ml-0.5",children:"★"})]}),e.jsx("div",{className:"flex-grow h-2.5 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-400 rounded-full transition-all duration-500",style:{width:`${t}%`}})}),e.jsx("div",{className:"w-8 text-right text-gray-500 text-xs",children:a})]},o)})})]}),e.jsx("div",{className:"space-y-4",children:m.map(a=>{var t,s;const r=b((t=a.avaliador)==null?void 0:t.foto_url),o=((s=a.avaliador)==null?void 0:s.nome)||"Usuário Removido";return e.jsxs("div",{className:"bg-gray-800 p-5 rounded-lg border border-gray-700 hover:border-gray-600 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[r?e.jsx("img",{src:r,alt:o,className:"w-10 h-10 rounded-full object-cover border border-gray-600"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-gray-400 border border-gray-600",children:e.jsx(_,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white text-sm",children:o}),e.jsx("p",{className:"text-[10px] text-gray-500",children:new Date(a.criado_em).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"})})]})]}),e.jsx("div",{className:"flex text-yellow-400 bg-gray-900/50 px-2 py-1 rounded-full border border-gray-700",children:[...Array(5)].map((N,c)=>e.jsx(x,{className:`w-3.5 h-3.5 ${c<a.nota?"fill-current":"text-gray-600"}`},c))})]}),a.comentario&&e.jsx("div",{className:"pl-14",children:e.jsxs("p",{className:"text-gray-300 text-sm leading-relaxed",children:['"',a.comentario,'"']})})]},a.id)})})]}):e.jsx(E,{icon:x,title:"Sem avaliações ainda",description:"Este perfil ainda não recebeu feedbacks. Seja o primeiro a contratar e avaliar!"})})};export{A as C,$ as R};
