import{j as e,b,e as p}from"./index-Cc-Lnn9x.js";import{r as n,R as V}from"./vendor-react-Dfcn4nkY.js";import{F as G}from"./FileIcon-2gY8woLq.js";import{D as K}from"./DownloadIcon-UF4vjtv3.js";import{T as Z}from"./TrashIcon-Dw3P_7Ho.js";import{C as H}from"./ConfirmationModal-FOR2G1eE.js";import{E as I}from"./ExclamationIcon-CXRxAwkS.js";import{U as Q}from"./UploadIcon-B6cBKZfY.js";import"./vendor-jspdf-Bh_S0msn.js";import"./vendor-utils-DmyZJLyO.js";import"./vendor-ui-DKtFGipk.js";const k=({className:m="w-6 h-6"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:m,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),M=[{id:"site",name:"Site",description:"Arquivos de identidade visual (logo, favicon)."},{id:"contratos",name:"Contratos",description:"PDFs de contratos gerados e assinados."},{id:"blog",name:"Blog",description:"Imagens de capa e mídia para postagens."},{id:"artista",name:"Artistas",description:"Portfólios, fotos de capa e galerias dos artistas."},{id:"estabelecimento",name:"Estabelecimentos",description:"Fotos do local e galerias dos estabelecimentos."},{id:"perfis",name:"Perfis",description:"Avatares de perfil de todos os usuários."}],W=(m,w=2)=>{if(m===0)return"0 Bytes";const a=1024,j=w<0?0:w,l=["Bytes","KB","MB","GB","TB"],h=Math.floor(Math.log(m)/Math.log(a));return parseFloat((m/Math.pow(a,h)).toFixed(j))+" "+l[h]},ne=()=>{const[m,w]=n.useState([]),[a,j]=n.useState(null),[l,h]=n.useState([]),[S,B]=n.useState([]),[$,F]=n.useState(!1),[A,u]=n.useState(""),[f,D]=n.useState(null),[R,E]=n.useState(!1),[C,y]=n.useState(!1),[v,P]=n.useState(!1);n.useEffect(()=>{(async()=>{const r=await Promise.all(M.map(async s=>{try{const{error:i}=await b.storage.from(s.id).list("",{limit:1});return i?(typeof i.message=="string"?i.message:"").toLowerCase().includes("not found")?{id:s.id,error:"Bucket não encontrado"}:{id:s.id,error:p(i)}:{id:s.id}}catch(i){return{id:s.id,error:p(i)}}}));w(r);const o=r.find(s=>!s.error);o&&!a&&j(o.id)})()},[]);const N=n.useCallback(async(t,r)=>{F(!0),u("");try{const o=r.join("/"),{data:s,error:i}=await b.storage.from(t).list(o,{sortBy:{column:"name",order:"asc"},limit:100});if(i)throw i;if(!s){B([]);return}const c=s.filter(d=>d.id===null).sort((d,g)=>d.name.localeCompare(g.name)),x=s.filter(d=>d.id!==null).sort((d,g)=>d.name.localeCompare(g.name));B([...c,...x])}catch(o){console.error(o),u(`Erro ao listar arquivos do bucket '${t}': ${p(o)}`)}finally{F(!1)}},[]);n.useEffect(()=>{a&&N(a,l)},[a,l,N]);const q=t=>{j(t),h([])},U=t=>{h(l.slice(0,t+1))},z=t=>{h([...l,t])},L=async t=>{if(!t.target.files||t.target.files.length===0||!a)return;P(!0),u("");const r=Array.from(t.target.files),o=l.length>0?l.join("/")+"/":"";try{const s=r.map(x=>{const d=x.name.replace(/[^a-zA-Z0-9.-]/g,"_"),g=`${o}${d}`;return b.storage.from(a).upload(g,x,{upsert:!0})}),c=(await Promise.all(s)).filter(x=>x.error);if(c.length>0){const x=c[0].error,d=p(x);throw new Error(`${c.length} arquivo(s) falharam no envio. Ex: ${d}`)}N(a,l)}catch(s){u(`Erro no upload: ${p(s)}`)}finally{P(!1),t.target.value=""}},T=async t=>{if(a){y(!0);try{const r=[...l,t].join("/"),{data:o,error:s}=await b.storage.from(a).download(r);if(s)throw s;const i=URL.createObjectURL(o),c=document.createElement("a");c.href=i,c.download=t,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(i)}catch(r){u(`Erro ao baixar arquivo: ${p(r)}`)}finally{y(!1)}}},_=t=>{D(t),E(!0)},O=async()=>{if(!(!f||!a)){y(!0);try{const t=[...l,f.name].join("/"),{error:r}=await b.storage.from(a).remove([t]);if(r)throw r;N(a,l)}catch(t){u(`Erro ao excluir arquivo: ${p(t)}`)}finally{y(!1),E(!1),D(null)}}};return e.jsxs("div",{className:"text-white animate-fade-in relative pb-20",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end mb-12 gap-8",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-heading-hero mb-3 uppercase",children:["ARMAZENAMENTO ",e.jsx("span",{className:"text-primary italic",children:"DE ARQUIVOS"})]}),e.jsx("p",{className:"text-section-label text-gray-500",children:"Gestão Descentralizada de Mídia e Documentos"})]})}),m.some(t=>t.error)&&e.jsxs("div",{className:"glass-card mb-8 p-6 rounded-3xl border-yellow-500/20 bg-yellow-500/5 text-yellow-500 text-section-label flex items-start gap-4 shadow-2xl",children:[e.jsx(I,{className:"w-6 h-6 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-black text-white mb-1",children:"Aviso de Configuração"}),e.jsxs("p",{className:"text-gray-500 normal-case font-medium",children:["Buckets Ausentes: ",e.jsx("strong",{children:m.filter(t=>t.error).map(t=>t.id).join(", ")}),". Verifique as políticas de RLS e a existência dos buckets no Supabase."]})]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-10 min-h-[60vh]",children:[e.jsx("aside",{className:"w-full lg:w-80 flex-shrink-0",children:e.jsxs("div",{className:"glass-card p-8 rounded-3xl border-white/5 shadow-2xl h-full",children:[e.jsx("h2",{className:"text-section-label text-gray-500 mb-8 px-2",children:"Repositórios de Dados"}),e.jsx("nav",{className:"space-y-4",children:M.map(t=>{const r=m.find(i=>i.id===t.id),o=!!(r!=null&&r.error),s=a===t.id;return e.jsxs("button",{onClick:()=>!o&&q(t.id),disabled:o,className:`w-full group relative flex flex-col p-6 rounded-2xl transition-all duration-500 border overflow-hidden ${s?"bg-primary text-white border-primary shadow-[0_10px_30px_rgba(var(--primary-rgb),0.2)]":o?"bg-red-500/5 text-red-500/50 border-red-500/10 cursor-not-allowed opacity-40":"bg-white/5 text-gray-400 border-white/5 hover:bg-white/[0.08] hover:text-white hover:border-white/10"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 relative z-10 w-full",children:[e.jsx("span",{className:"text-[11px] font-black uppercase tracking-widest truncate",children:t.name}),o?e.jsx(I,{className:"w-4 h-4 opacity-50"}):s&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white shadow-[0_0_10px_white]"})]}),e.jsx("span",{className:`text-[9px] font-mono font-black uppercase tracking-tighter opacity-50 relative z-10 ${s?"text-white":"text-gray-600 group-hover:text-primary"}`,children:t.id})]},t.id)})})]})}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"glass-card p-0 rounded-3xl border-white/5 shadow-2xl flex flex-col h-full overflow-hidden",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-8 border-b border-white/5 bg-white/[0.01]",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-8 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-black/40 px-6 py-4 rounded-2xl border border-white/5 flex-grow group",children:[e.jsx(k,{className:"w-5 h-5 text-gray-600 group-hover:text-primary transition-colors"}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto custom-scrollbar no-scrollbar text-[10px] font-black uppercase tracking-widest",children:[e.jsx("button",{onClick:()=>h([]),className:"hover:text-white text-gray-500 transition-colors whitespace-nowrap",children:a}),l.map((t,r)=>e.jsxs(V.Fragment,{children:[e.jsx("span",{className:"text-gray-800",children:"/"}),e.jsx("button",{onClick:()=>U(r),className:"hover:text-white text-gray-500 transition-colors whitespace-nowrap",children:t})]},r))]})]}),e.jsxs("div",{className:"shrink-0 w-full sm:w-auto",children:[e.jsxs("label",{htmlFor:"file-upload",className:`w-full group flex items-center justify-center gap-4 bg-white text-dark font-black uppercase tracking-[0.2em] text-[10px] py-4 px-8 rounded-2xl transition-all shadow-xl hover:bg-primary hover:text-white active:scale-95 ${v?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx(Q,{className:`w-5 h-5 transition-transform group-hover:-translate-y-1 ${v?"animate-bounce":""}`}),v?"Enviando...":"Enviar Arquivo"]}),e.jsx("input",{id:"file-upload",type:"file",multiple:!0,className:"hidden",onChange:L,disabled:v})]})]}),A&&e.jsxs("div",{className:"mt-4 p-5 bg-red-500/10 border border-red-500/20 text-red-500 rounded-xl text-[9px] font-black uppercase tracking-widest animate-shake",children:["Erro de Protocolo: ",A]})]}),e.jsx("div",{className:"flex-1 overflow-x-auto custom-scrollbar",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-white/5 border-b border-white/5 text-section-label text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-6 w-1/2",children:"Nome do Objeto"}),e.jsx("th",{className:"p-6 hidden sm:table-cell",children:"Tamanho"}),e.jsx("th",{className:"p-6 hidden md:table-cell",children:"Último Sync"}),e.jsx("th",{className:"p-6 text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:$?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"p-20 text-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-primary/20 border-t-primary rounded-full animate-spin mx-auto mb-6"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-gray-500 animate-pulse",children:"Filtrando Fluxos de Dados..."})]})}):S.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"p-20 text-center text-gray-600",children:[e.jsxs("div",{className:"relative w-16 h-16 mx-auto mb-8 group/empty opacity-20",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/10 rounded-full blur-2xl group-hover/empty:scale-150 transition-transform"}),e.jsx(k,{className:"w-16 h-16 text-gray-400 relative z-10"})]}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.4em]",children:"Setor Vazio. Pronto para depósito."})]})}):S.map(t=>{const r=t.id===null;return e.jsxs("tr",{className:"hover:bg-white/5 transition-colors group",children:[e.jsx("td",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center border transition-all ${r?"bg-yellow-500/5 border-yellow-500/10 text-yellow-500":"bg-primary/5 border-primary/10 text-primary"}`,children:r?e.jsx(k,{className:"w-5 h-5"}):e.jsx(G,{className:"w-5 h-5"})}),r?e.jsx("button",{onClick:()=>z(t.name),className:"text-lg font-black text-white hover:text-primary font-poppins tracking-tighter transition-colors text-left truncate uppercase",children:t.name}):e.jsx("span",{className:"text-lg font-medium text-gray-300 font-poppins tracking-tight truncate",children:t.name})]})}),e.jsx("td",{className:"p-6 text-[10px] text-gray-500 hidden sm:table-cell font-mono font-black",children:r||!t.metadata?"---":W(t.metadata.size)}),e.jsx("td",{className:"p-6 text-[10px] text-gray-500 hidden md:table-cell font-mono font-black uppercase tracking-tighter",children:t.updated_at?new Date(t.updated_at).toLocaleDateString("pt-BR"):"N/A"}),e.jsx("td",{className:"p-6",children:!r&&e.jsxs("div",{className:"flex justify-end gap-3 opacity-0 group-hover:opacity-100 transition-all",children:[e.jsx("button",{onClick:()=>T(t.name),disabled:C,className:"w-10 h-10 flex items-center justify-center bg-white/5 text-gray-500 hover:text-white hover:border-primary/50 rounded-xl border border-white/5 transition-all active:scale-95",title:"Baixar Arquivo",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_(t),disabled:C,className:"w-12 h-12 flex items-center justify-center bg-red-500/5 text-red-500 hover:text-white hover:bg-red-500 rounded-xl border border-red-500/10 transition-all active:scale-95",title:"Excluir Arquivo",children:e.jsx(Z,{className:"w-5 h-5"})})]})})]},t.name)})})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-20 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-white/5 rounded-[2rem] border border-white/5 flex items-center justify-center mb-10 opacity-30",children:e.jsx(k,{className:"w-12 h-12 text-gray-400"})}),e.jsx("h2",{className:"text-3xl font-black text-white font-poppins tracking-tighter mb-4 uppercase",children:"Selecionar Repositório"}),e.jsx("p",{className:"max-w-md text-gray-600 text-[10px] font-black uppercase tracking-widest leading-premium",children:"Selecione um setor de dados na barra lateral para gerenciar objetos e mídias."})]})})})]}),e.jsx(H,{isOpen:R,onClose:()=>E(!1),onConfirm:O,title:"Confirmar Exclusão",message:e.jsxs("p",{children:["Tem certeza que deseja excluir o arquivo ",e.jsx("strong",{className:"text-white",children:f==null?void 0:f.name}),"? Esta ação é irreversível."]}),confirmText:"Sim, Excluir",isConfirming:C})]})};export{ne as default};
