import{j as e,b as y,e as p,a as N}from"./index-DlAvHY7j.js";import{r as l}from"./vendor-react-Dfcn4nkY.js";import{S as I}from"./SearchIcon-BYpUjHCe.js";import{U}from"./UserCircleIcon-DelMjjQL.js";import{C as v}from"./CheckCircleIcon-ChAVo4Go.js";import{X as E}from"./XCircleIcon-BlnaoKfv.js";import{T as P}from"./TrophyIcon-aQDOPTJ2.js";import{C as $}from"./ConfirmationModal-CoXaAJF8.js";import"./vendor-jspdf-Bh_S0msn.js";import"./vendor-utils-DmyZJLyO.js";import"./vendor-ui-DKtFGipk.js";import"./ExclamationIcon-eeCGJaS7.js";const z=({className:n="w-6 h-6"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:n,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2 4l3 12h14l3-12-6 7-4-7-4 7-6-7zM5 20h14"})}),Q=()=>{const[n,i]=l.useState([]),[w,h]=l.useState(!0),[F,u]=l.useState(null),[c,C]=l.useState(""),[d,S]=l.useState("all"),[x,T]=l.useState("all"),[s,g]=l.useState(null),[k,m]=l.useState(!1),[A,f]=l.useState(!1),b=async()=>{h(!0),u(null);try{let a=y.from("usuarios").select(`
                    *,
                    artista:artistas(id),
                    estabelecimento:estabelecimentos(id)
                `).order("criado_em",{ascending:!1});const{data:r,error:t}=await a;if(t)throw t;i((r||[]).map(o=>({...o,artista:Array.isArray(o.artista)?o.artista[0]:o.artista,estabelecimento:Array.isArray(o.estabelecimento)?o.estabelecimento[0]:o.estabelecimento})))}catch(a){u(p(a))}finally{h(!1)}};l.useEffect(()=>{b()},[]);const j=n.filter(a=>{const r=a.nome.toLowerCase().includes(c.toLowerCase())||a.email.toLowerCase().includes(c.toLowerCase()),t=d==="all"||a.role===d,o=x==="all"||a.tipo===x;return r&&t&&o}),B=async()=>{if(s){f(!0);try{const a=s.role==="banned"?"user":"banned";await N.updateBasicInfo(s.id,{role:a}),i(r=>r.map(t=>t.id===s.id?{...t,role:a}:t)),m(!1),g(null)}catch(a){alert("Erro ao atualizar usuário: "+p(a))}finally{f(!1)}}},L=async(a,r)=>{if(window.confirm(`Tem certeza que deseja alterar o nível de acesso de ${a.nome} para ${r}?`))try{await N.updateBasicInfo(a.id,{role:r}),i(t=>t.map(o=>o.id===a.id?{...o,role:r}:o))}catch(t){alert("Erro: "+p(t))}},M=a=>{const r=a.plano;if(!r||r==="free")return e.jsx("span",{className:"text-gray-500 text-xs",children:"Free"});let t="text-blue-300 bg-blue-500/10 border-blue-500/30";return r==="business"&&(t="text-yellow-300 bg-yellow-500/10 border-yellow-500/30"),r==="pro"&&(t="text-primary bg-primary/10 border-primary/30"),e.jsxs("span",{className:`px-2 py-0.5 rounded text-[10px] font-black uppercase border flex items-center gap-1 w-fit ${t}`,children:[(r==="business"||r==="pro")&&e.jsx(z,{className:"w-3 h-3"}),r.toUpperCase()]})};return e.jsxs("div",{className:"text-white animate-fade-in",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-primary font-poppins",children:"Gestão de Usuários"}),e.jsx("p",{className:"text-gray-400 mb-8",children:"Administre contas, permissões e status de acesso."}),e.jsxs("div",{className:"bg-gray-800 p-5 rounded-xl mb-8 border border-gray-700 shadow-md flex flex-col xl:flex-row items-center gap-4",children:[e.jsxs("div",{className:"relative flex-grow w-full xl:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Buscar por nome ou email...",value:c,onChange:a=>C(a.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-primary text-white"}),e.jsx(I,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"})]}),e.jsxs("div",{className:"flex gap-2 w-full xl:w-auto overflow-x-auto",children:[e.jsxs("select",{value:x,onChange:a=>T(a.target.value),className:"bg-gray-900 border border-gray-600 rounded-lg py-2 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary text-white",children:[e.jsx("option",{value:"all",children:"Todos Tipos"}),e.jsx("option",{value:"artista",children:"Artistas"}),e.jsx("option",{value:"estabelecimento",children:"Locais"})]}),e.jsxs("select",{value:d,onChange:a=>S(a.target.value),className:"bg-gray-900 border border-gray-600 rounded-lg py-2 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary text-white",children:[e.jsx("option",{value:"all",children:"Todas Permissões"}),e.jsx("option",{value:"user",children:"Usuário Comum"}),e.jsx("option",{value:"moderador",children:"Moderador"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"admin-master",children:"Master"}),e.jsx("option",{value:"banned",children:"Banido"})]})]}),e.jsx("button",{onClick:b,className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors whitespace-nowrap",children:"Atualizar Lista"})]}),e.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-900 text-gray-400 text-xs uppercase font-bold sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 pl-6",children:"Usuário"}),e.jsx("th",{className:"p-4",children:"Tipo"}),e.jsx("th",{className:"p-4",children:"Plano"}),e.jsx("th",{className:"p-4",children:"Status Verificação"}),e.jsx("th",{className:"p-4",children:"Permissão"}),e.jsx("th",{className:"p-4 text-right pr-6",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700 text-sm",children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-12 text-center text-gray-500 animate-pulse",children:"Carregando usuários..."})}):j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-12 text-center text-gray-500",children:"Nenhum usuário encontrado."})}):j.map(a=>e.jsxs("tr",{className:"hover:bg-gray-700/30 transition-colors group",children:[e.jsx("td",{className:"p-4 pl-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 flex-shrink-0 overflow-hidden",children:a.foto_url?e.jsx("img",{src:y.storage.from("perfis").getPublicUrl(a.foto_url).data.publicUrl,className:"w-full h-full object-cover"}):e.jsx(U,{className:"w-full h-full text-gray-500 p-2"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-bold text-white truncate max-w-[200px]",children:a.nome}),e.jsx("p",{className:"text-xs text-gray-400 truncate max-w-[200px]",children:a.email})]})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${a.tipo==="artista"?"bg-purple-500/10 text-purple-300":"bg-orange-500/10 text-orange-300"}`,children:a.tipo})}),e.jsx("td",{className:"p-4",children:M(a)}),e.jsx("td",{className:"p-4",children:a.status_verificacao==="verificado"?e.jsxs("span",{className:"flex items-center gap-1 text-green-400 text-xs font-bold",children:[e.jsx(v,{className:"w-4 h-4"})," Verificado"]}):a.status_verificacao==="pendente"?e.jsxs("span",{className:"flex items-center gap-1 text-yellow-500 text-xs font-bold",children:[e.jsx(P,{className:"w-4 h-4"})," Pendente"]}):e.jsx("span",{className:"text-gray-600 text-xs",children:"Não verificado"})}),e.jsx("td",{className:"p-4",children:e.jsxs("select",{value:a.role||"user",onChange:r=>L(a,r.target.value),className:`bg-transparent text-xs font-bold uppercase cursor-pointer focus:outline-none ${a.role==="admin-master"?"text-red-400":a.role==="admin"?"text-red-300":"text-gray-300"}`,children:[e.jsx("option",{value:"user",className:"bg-gray-900",children:"User"}),e.jsx("option",{value:"moderador",className:"bg-gray-900",children:"Mod"}),e.jsx("option",{value:"admin",className:"bg-gray-900",children:"Admin"}),e.jsx("option",{value:"admin-master",className:"bg-gray-900",children:"Master"}),e.jsx("option",{value:"banned",className:"bg-gray-900",children:"Banned"})]})}),e.jsx("td",{className:"p-4 text-right pr-6",children:e.jsx("button",{onClick:()=>{g(a),m(!0)},className:`p-2 rounded-lg transition-colors ${a.role==="banned"?"bg-green-600/20 text-green-400 hover:bg-green-600/30":"bg-red-600/20 text-red-400 hover:bg-red-600/30"}`,title:a.role==="banned"?"Desbanir Usuário":"Banir Usuário",children:a.role==="banned"?e.jsx(v,{className:"w-5 h-5"}):e.jsx(E,{className:"w-5 h-5"})})})]},a.id))})]})})}),e.jsx($,{isOpen:k,onClose:()=>m(!1),onConfirm:B,title:(s==null?void 0:s.role)==="banned"?"Reativar Conta":"Banir Usuário",message:e.jsxs("p",{children:["Tem certeza que deseja ",(s==null?void 0:s.role)==="banned"?"reativar":"banir"," o acesso de ",e.jsx("strong",{children:s==null?void 0:s.nome})," da plataforma?"]}),confirmText:(s==null?void 0:s.role)==="banned"?"Reativar":"Banir",isConfirming:A,variant:(s==null?void 0:s.role)==="banned"?"success":"danger"})]})};export{Q as default};
