import{j as e,b,e as u}from"./index-DlAvHY7j.js";import{r as i,R as V}from"./vendor-react-Dfcn4nkY.js";import{F as G}from"./FileIcon-Cvyn-_EG.js";import{D as K}from"./DownloadIcon-hZE2TndI.js";import{T as H}from"./TrashIcon-DYCb4kG1.js";import{C as W}from"./ConfirmationModal-CoXaAJF8.js";import{E as A}from"./ExclamationIcon-eeCGJaS7.js";import{U as Z}from"./UploadIcon-BZqKiu8k.js";import{C as J}from"./CheckCircleIcon-ChAVo4Go.js";import"./vendor-jspdf-Bh_S0msn.js";import"./vendor-utils-DmyZJLyO.js";import"./vendor-ui-DKtFGipk.js";const N=({className:m="w-6 h-6"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:m,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),D=[{id:"site",name:"Site",description:"Arquivos de identidade visual (logo, favicon)."},{id:"contratos",name:"Contratos",description:"PDFs de contratos gerados e assinados."},{id:"blog",name:"Blog",description:"Imagens de capa e mídia para postagens."},{id:"artista",name:"Artistas",description:"Portfólios, fotos de capa e galerias dos artistas."},{id:"estabelecimento",name:"Estabelecimentos",description:"Fotos do local e galerias dos estabelecimentos."},{id:"perfis",name:"Perfis",description:"Avatares de perfil de todos os usuários."}],Q=(m,j=2)=>{if(m===0)return"0 Bytes";const a=1024,y=j<0?0:j,n=["Bytes","KB","MB","GB","TB"],h=Math.floor(Math.log(m)/Math.log(a));return parseFloat((m/Math.pow(a,h)).toFixed(y))+" "+n[h]},de=()=>{const[m,j]=i.useState([]),[a,y]=i.useState(null),[n,h]=i.useState([]),[S,B]=i.useState([]),[M,F]=i.useState(!1),[q,p]=i.useState(""),[g,P]=i.useState(null),[U,k]=i.useState(!1),[C,w]=i.useState(!1),[E,I]=i.useState(!1);i.useEffect(()=>{(async()=>{const t=await Promise.all(D.map(async r=>{try{const{error:l}=await b.storage.from(r.id).list("",{limit:1});return l?(typeof l.message=="string"?l.message:"").toLowerCase().includes("not found")?{id:r.id,error:"Bucket não encontrado"}:{id:r.id,error:u(l)}:{id:r.id}}catch(l){return{id:r.id,error:u(l)}}}));j(t);const o=t.find(r=>!r.error);o&&!a&&y(o.id)})()},[]);const v=i.useCallback(async(s,t)=>{F(!0),p("");try{const o=t.join("/"),{data:r,error:l}=await b.storage.from(s).list(o,{sortBy:{column:"name",order:"asc"},limit:100});if(l)throw l;if(!r){B([]);return}const c=r.filter(d=>d.id===null).sort((d,f)=>d.name.localeCompare(f.name)),x=r.filter(d=>d.id!==null).sort((d,f)=>d.name.localeCompare(f.name));B([...c,...x])}catch(o){console.error(o),p(`Erro ao listar arquivos do bucket '${s}': ${u(o)}`)}finally{F(!1)}},[]);i.useEffect(()=>{a&&v(a,n)},[a,n,v]);const $=s=>{y(s),h([])},L=s=>{h(n.slice(0,s+1))},T=s=>{h([...n,s])},z=async s=>{if(!s.target.files||s.target.files.length===0||!a)return;I(!0),p("");const t=Array.from(s.target.files),o=n.length>0?n.join("/")+"/":"";try{const r=t.map(x=>{const d=x.name.replace(/[^a-zA-Z0-9.-]/g,"_"),f=`${o}${d}`;return b.storage.from(a).upload(f,x,{upsert:!0})}),c=(await Promise.all(r)).filter(x=>x.error);if(c.length>0){const x=c[0].error,d=u(x);throw new Error(`${c.length} arquivo(s) falharam no envio. Ex: ${d}`)}v(a,n)}catch(r){p(`Erro no upload: ${u(r)}`)}finally{I(!1),s.target.value=""}},R=async s=>{if(a){w(!0);try{const t=[...n,s].join("/"),{data:o,error:r}=await b.storage.from(a).download(t);if(r)throw r;const l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=s,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(l)}catch(t){p(`Erro ao baixar arquivo: ${u(t)}`)}finally{w(!1)}}},O=s=>{P(s),k(!0)},_=async()=>{if(!(!g||!a)){w(!0);try{const s=[...n,g.name].join("/"),{error:t}=await b.storage.from(a).remove([s]);if(t)throw t;v(a,n)}catch(s){p(`Erro ao excluir arquivo: ${u(s)}`)}finally{w(!1),k(!1),P(null)}}};return e.jsxs("div",{className:"text-white animate-fade-in",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-primary font-poppins",children:"Gerenciamento de Buckets e Arquivos"}),e.jsx("p",{className:"text-gray-400 mb-8 max-w-2xl",children:"Navegue, baixe, exclua e envie arquivos para os buckets de armazenamento da aplicação. Certifique-se de que os buckets listados abaixo existem no painel do Supabase."}),m.some(s=>s.error)&&e.jsxs("div",{className:"bg-yellow-500/10 border-l-4 border-yellow-500 text-yellow-300 p-4 rounded-r-lg mb-6 text-sm flex items-start gap-3",role:"alert",children:[e.jsx(A,{className:"w-6 h-6 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Aviso de Configuração"}),e.jsxs("p",{children:["Alguns buckets obrigatórios não foram encontrados ou não têm permissão de acesso público. Verifique se os buckets ",e.jsx("strong",{children:m.filter(s=>s.error).map(s=>s.id).join(", ")})," foram criados no Supabase e se as Políticas de Segurança (RLS) estão configuradas."]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 min-h-[60vh]",children:[e.jsxs("aside",{className:"w-full md:w-72 bg-gray-800 p-4 rounded-lg flex-shrink-0 border border-gray-700",children:[e.jsx("h2",{className:"font-bold text-lg mb-4 text-white border-b border-gray-700 pb-2",children:"Buckets Disponíveis"}),e.jsx("nav",{className:"space-y-2",children:D.map(s=>{const t=m.find(l=>l.id===s.id),o=!!(t!=null&&t.error),r=a===s.id;return e.jsxs("button",{onClick:()=>!o&&$(s.id),disabled:o,className:`w-full text-left flex items-center justify-between px-3 py-3 rounded-md text-sm font-medium transition-all ${r?"bg-secondary text-white shadow-lg":o?"bg-red-900/10 text-red-400 cursor-not-allowed border border-red-900/20":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:[e.jsxs("div",{className:"flex flex-col min-w-0 pr-2",children:[e.jsx("span",{className:"truncate font-bold",children:s.name}),e.jsx("span",{className:`text-[10px] truncate ${r?"text-gray-200":"text-gray-500"}`,children:s.id})]}),o?e.jsx("span",{title:typeof t.error=="string"?t.error:"Erro desconhecido",children:e.jsx(A,{className:"w-5 h-5 flex-shrink-0"})}):r&&e.jsx(J,{className:"w-5 h-5 flex-shrink-0"})]},s.id)})})]}),e.jsx("div",{className:"flex-1 bg-gray-800 p-6 rounded-lg border border-gray-700 flex flex-col",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"text-sm text-gray-400 flex items-center gap-2 flex-wrap bg-gray-900 px-3 py-2 rounded-md border border-gray-700",children:[e.jsx(N,{className:"w-4 h-4 text-gray-500"}),e.jsx("button",{onClick:()=>h([]),className:"font-bold hover:text-white transition-colors",children:a}),n.map((s,t)=>e.jsxs(V.Fragment,{children:[e.jsx("span",{className:"text-gray-600",children:"/"}),e.jsx("button",{onClick:()=>L(t),className:"hover:text-white transition-colors",children:s})]},t))]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"file-upload",className:`flex items-center gap-2 bg-gradient-to-r from-primary to-secondary text-white font-bold py-2 px-4 rounded-md hover:shadow-lg transition-all transform hover:-translate-y-0.5 ${E?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx(Z,{className:"w-5 h-5"}),E?"Enviando...":"Upload de Arquivo"]}),e.jsx("input",{id:"file-upload",type:"file",multiple:!0,className:"hidden",onChange:z,disabled:E})]})]}),q&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/30 text-red-400 rounded-md text-sm",children:q}),e.jsx("div",{className:"flex-grow overflow-x-auto bg-gray-900 rounded-lg border border-gray-700",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-900 border-b border-gray-700 text-gray-400 text-xs uppercase sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 font-semibold w-1/2",children:"Nome"}),e.jsx("th",{className:"p-3 font-semibold hidden sm:table-cell",children:"Tamanho"}),e.jsx("th",{className:"p-3 font-semibold hidden md:table-cell",children:"Modificado"}),e.jsx("th",{className:"p-3 font-semibold text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:M?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center p-10 text-gray-500",children:"Carregando arquivos..."})}):S.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"text-center p-12 text-gray-500 flex flex-col items-center justify-center",children:[e.jsx(N,{className:"w-12 h-12 mb-3 opacity-20"}),e.jsx("p",{children:"Esta pasta está vazia."})]})}):S.map(s=>{const t=s.id===null;return e.jsxs("tr",{className:"hover:bg-gray-800 transition-colors group",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t?e.jsx(N,{className:"w-5 h-5 text-yellow-500"}):e.jsx(G,{className:"w-5 h-5 text-blue-400"}),t?e.jsx("button",{onClick:()=>T(s.name),className:"font-medium text-white hover:underline truncate text-left",children:s.name}):e.jsx("span",{className:"text-gray-300 truncate",children:s.name})]})}),e.jsx("td",{className:"p-3 text-gray-500 text-sm hidden sm:table-cell font-mono",children:t||!s.metadata?"-":Q(s.metadata.size)}),e.jsx("td",{className:"p-3 text-gray-500 text-sm hidden md:table-cell",children:s.updated_at?new Date(s.updated_at).toLocaleDateString():"-"}),e.jsx("td",{className:"p-3 text-right",children:!t&&e.jsxs("div",{className:"flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>R(s.name),disabled:C,className:"p-1.5 text-gray-400 hover:text-white bg-gray-700 hover:bg-gray-600 rounded",title:"Baixar",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>O(s),disabled:C,className:"p-1.5 text-gray-400 hover:text-red-400 bg-gray-700 hover:bg-gray-600 rounded",title:"Excluir",children:e.jsx(H,{className:"w-4 h-4"})})]})})]},s.name)})})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500 p-8",children:[e.jsx(N,{className:"w-16 h-16 mb-4 text-gray-600 opacity-50"}),e.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Selecione um Bucket"}),e.jsx("p",{className:"max-w-md",children:"Escolha um dos buckets disponíveis na barra lateral para visualizar e gerenciar seus arquivos."})]})})]}),e.jsx(W,{isOpen:U,onClose:()=>k(!1),onConfirm:_,title:"Confirmar Exclusão",message:e.jsxs("p",{children:["Tem certeza que deseja excluir o arquivo ",e.jsx("strong",{className:"text-white",children:g==null?void 0:g.name}),"? Esta ação é irreversível."]}),confirmText:"Sim, Excluir",isConfirming:C})]})};export{de as default};
