import{d as C,j as e,b as n,e as _}from"./index-TxEahy0v.js";import{u as P,r as o}from"./vendor-react-Dfcn4nkY.js";import{U as q}from"./UserCircleIcon-CgEwXyMh.js";import"./vendor-pdf-CuP9pQX9.js";import"./vendor-utils-DmyZJLyO.js";import"./vendor-ui-NgL_OKOJ.js";const D=()=>{const{user:a,profileMissing:m,refreshProfile:w,loading:u}=C(),d=P(),[r,b]=o.useState("artista"),[s,f]=o.useState(""),[c,N]=o.useState(""),[g,x]=o.useState(""),[p,h]=o.useState(!1);o.useEffect(()=>{var t;u||(a?m?(t=a.user_metadata)!=null&&t.full_name&&!s&&f(a.user_metadata.full_name):d("/painel"):d("/login"))},[a,m,u,d,s]);const v=async t=>{if(t.preventDefault(),!(p||!a)){if(!s.trim()||!c.trim()){x("Preencha todos os campos obrigatórios.");return}x(""),h(!0);try{const{data:i}=await n.from("usuarios").select("id").eq("auth_id",a.id).maybeSingle();let l=i==null?void 0:i.id;if(l)await n.from("usuarios").update({nome:s.trim(),cidade:c.trim(),tipo:r}).eq("id",l);else{const{data:E,error:j}=await n.from("usuarios").insert({auth_id:a.id,email:a.email,nome:s.trim(),cidade:c.trim(),tipo:r}).select("id").single();if(j)throw j;l=E.id}const k=r==="artista"?"artistas":"estabelecimentos",S=r==="artista"?"estabelecimentos":"artistas";await n.from(S).delete().eq("usuario_id",l);const{error:y}=await n.from(k).upsert({usuario_id:l},{onConflict:"usuario_id"});if(y)throw y;await w(),d("/painel")}catch(i){x("Erro ao finalizar cadastro: "+_(i))}finally{h(!1)}}};return u||!m?e.jsx("div",{className:"flex justify-center items-center h-screen bg-dark",children:e.jsx("div",{className:"text-white text-xl animate-pulse",children:"Sincronizando..."})}):e.jsxs("main",{className:"relative min-h-[calc(100vh-144px)] flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:"url('https://images.unsplash.com/photo-1516321497487-e288fb19713f?q=80&w=2070&auto=format&fit=crop')",filter:"brightness(0.2)"}}),e.jsxs("section",{className:"relative z-10 max-w-md w-full space-y-8 bg-gray-900/90 backdrop-blur-xl p-10 rounded-3xl shadow-2xl border border-gray-800",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-16 w-16 bg-primary/10 rounded-full flex items-center justify-center mb-4 border border-primary/20",children:e.jsx(q,{className:"h-10 w-10 text-primary"})}),e.jsx("h2",{className:"text-3xl font-black text-white font-poppins",children:"Finalizar Perfil"}),e.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Escolha como deseja atuar na plataforma."})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:v,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-2 ml-1",children:"Tipo de Conta"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>b("artista"),className:`py-4 rounded-xl text-sm font-black transition-all ${r==="artista"?"bg-primary text-dark shadow-lg shadow-primary/20":"bg-gray-800 text-gray-400 hover:bg-gray-700 border border-gray-700"}`,children:"Sou Artista"}),e.jsx("button",{type:"button",onClick:()=>b("estabelecimento"),className:`py-4 rounded-xl text-sm font-black transition-all ${r==="estabelecimento"?"bg-secondary text-white shadow-lg shadow-secondary/20":"bg-gray-800 text-gray-400 hover:bg-gray-700 border border-gray-700"}`,children:"Sou Local"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-2 ml-1",children:"Nome de Exibição"}),e.jsx("input",{type:"text",required:!0,className:"w-full bg-gray-800 border border-gray-700 rounded-xl py-3 px-4 text-white focus:ring-2 focus:ring-primary outline-none transition-all",placeholder:r==="artista"?"Nome da banda ou DJ":"Nome do Bar/Casa",value:s,onChange:t=>f(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-2 ml-1",children:"Cidade Base"}),e.jsx("input",{type:"text",required:!0,className:"w-full bg-gray-800 border border-gray-700 rounded-xl py-3 px-4 text-white focus:ring-2 focus:ring-primary outline-none transition-all",placeholder:"Ex: São Paulo, SP",value:c,onChange:t=>N(t.target.value)})]})]}),g&&e.jsx("p",{className:"text-red-400 text-xs text-center font-bold bg-red-400/10 p-3 rounded-lg border border-red-400/20 animate-shake",children:g}),e.jsx("button",{type:"submit",disabled:p,className:"w-full bg-gradient-to-r from-primary to-secondary text-dark font-black py-4 rounded-xl shadow-xl transition-all transform hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50",children:p?"Salvando...":"Entrar no RESONA"})]})]})]})};export{D as default};
