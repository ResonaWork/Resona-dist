import{r as s,j as e,P as m,e as g}from"./index-COZr6oUa.js";import{A as v,D as w}from"./ActivityIcon-CFzf47ir.js";import{E as C}from"./ExclamationIcon-42o_Tq39.js";import{S}from"./SearchIcon-CYbvkkvq.js";import{C as L}from"./ClockIcon-Dd-MByIB.js";import{T as k}from"./TrashIcon-CQzeBu6U.js";import{C as E}from"./ConfirmationModal-CVhQZqYw.js";const H=()=>{const[h,i]=s.useState([]),[l,n]=s.useState(!0),[u,d]=s.useState(!1),[A,b]=s.useState(""),[t,f]=s.useState(""),[r,c]=s.useState(null),[j,o]=s.useState(!1),x=async()=>{n(!0);try{const a=await m.fetchIaLogs();i(a)}catch(a){b(g(a))}finally{n(!1)}};s.useEffect(()=>{x()},[]);const y=async()=>{d(!0);try{await m.clearIaLogs(),i([]),c(null),o(!1)}catch(a){alert(g(a))}finally{d(!1)}},p=h.filter(a=>a.servico.toLowerCase().includes(t.toLowerCase())||a.tipo_erro.toLowerCase().includes(t.toLowerCase())||a.mensagem_erro.toLowerCase().includes(t.toLowerCase())),N=a=>{switch(a){case"CORS":return"bg-orange-500/20 text-orange-300 border-orange-500/30";case"NETWORK":return"bg-red-500/20 text-red-300 border-red-500/30";case"QUOTA":return"bg-purple-500/20 text-purple-300 border-purple-500/30";default:return"bg-gray-700 text-gray-300 border-gray-600"}};return e.jsxs("div",{className:"text-white animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-primary font-poppins flex items-center gap-3",children:[e.jsx(v,{className:"w-8 h-8"})," Saúde das Integrações (IA)"]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Rastreamento de erros em tempo real dos motores Gemini."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>o(!0),className:"bg-red-900/20 hover:bg-red-900/40 text-red-400 px-4 py-2 rounded-lg border border-red-900/30 transition-all flex items-center gap-2 text-sm font-bold",children:[e.jsx(k,{className:"w-4 h-4"})," Limpar Histórico"]}),e.jsxs("button",{onClick:x,className:"bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-700 transition-all flex items-center gap-2",children:[e.jsx(L,{className:`w-4 h-4 ${l?"animate-spin":""}`})," Atualizar Fila"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("input",{type:"text",placeholder:"Filtrar por serviço ou erro...",value:t,onChange:a=>f(a.target.value),className:"w-full bg-gray-900 border border-gray-700 rounded-xl py-3 pl-12 pr-4 text-white focus:ring-1 focus:ring-primary outline-none"}),e.jsx(S,{className:"absolute left-4 top-3.5 w-5 h-5 text-gray-500"})]}),e.jsx("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden shadow-xl",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-800 text-[10px] uppercase font-black text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Serviço / Contexto"}),e.jsx("th",{className:"p-4",children:"Tipo"}),e.jsx("th",{className:"p-4",children:"Horário"}),e.jsx("th",{className:"p-4 text-center",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:l?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-8 text-center text-gray-600 animate-pulse",children:"Sincronizando auditoria de rede..."})}):p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-8 text-center text-gray-600",children:"Nenhuma anomalia registrada. Sistema operando 100%."})}):p.map(a=>e.jsxs("tr",{onClick:()=>c(a),className:`cursor-pointer hover:bg-gray-800/50 transition-colors ${(r==null?void 0:r.id)===a.id?"bg-gray-800":""}`,children:[e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-bold text-white text-xs",children:a.servico.toUpperCase()}),e.jsx("div",{className:"text-[10px] text-gray-500 truncate max-w-[200px]",children:a.mensagem_erro})]}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-0.5 border rounded text-[10px] font-black uppercase ${N(a.tipo_erro)}`,children:a.tipo_erro})}),e.jsx("td",{className:"p-4 text-[10px] text-gray-500 font-mono",children:new Date(a.criado_em).toLocaleString("pt-BR")}),e.jsx("td",{className:"p-4 text-center",children:e.jsx(C,{className:"w-4 h-4 text-orange-500 mx-auto"})})]},a.id))})]})})})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 p-6 sticky top-24 shadow-2xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2 border-b border-gray-800 pb-3",children:[e.jsx(w,{className:"text-secondary w-5 h-5"})," Diagnóstico Técnico"]}),r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase font-black mb-1",children:"Causa Raiz"}),e.jsx("p",{className:"text-sm text-red-400 font-medium leading-relaxed bg-red-950/20 p-3 rounded-lg border border-red-900/30",children:r.mensagem_erro})]}),r.payload_input&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase font-black mb-1",children:"Payload de Entrada"}),e.jsx("div",{className:"p-3 bg-black rounded-xl border border-gray-800 font-mono text-[10px] text-green-400 overflow-x-auto whitespace-pre",children:JSON.stringify(r.payload_input,null,2)})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-800 flex flex-col gap-2",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase font-black",children:"ID do Evento"}),e.jsx("p",{className:"text-[9px] text-white font-mono break-all opacity-50",children:r.id}),e.jsx("p",{className:"text-[10px] text-gray-500 uppercase font-black mt-2",children:"Usuário Afetado"}),e.jsx("p",{className:"text-xs text-white",children:r.usuario_id||"Visitante Anônimo"})]}),e.jsxs("div",{className:"bg-primary/5 p-4 rounded-xl border border-primary/20",children:[e.jsx("p",{className:"text-[10px] text-primary font-black uppercase mb-1",children:"Recomendação Admin"}),e.jsx("p",{className:"text-xs text-gray-300",children:r.tipo_erro==="CORS"?"Verifique as políticas do bucket de storage.":r.tipo_erro==="QUOTA"?"Aumente o limite de tokens ou aguarde o reset da cota.":"Verifique a estabilidade da conexão do cliente."})]})]}):e.jsx("div",{className:"text-center py-20 text-gray-600 italic text-sm",children:"Selecione uma ocorrência para analisar os dados brutos de falha."})]})})]}),e.jsx(E,{isOpen:j,onClose:()=>o(!1),onConfirm:y,title:"Limpar Histórico de Erros",message:"Tem certeza que deseja remover todos os registros de erro de integração? Esta ação não pode ser desfeita e os dados de auditoria serão perdidos.",confirmText:"Limpar Tudo",isConfirming:u})]})};export{H as default};
