import{r as p,j as e,d as w,e as M}from"./index-GuXP6Wz1.js";import{U as E}from"./UsersIcon-E2bBNV8B.js";import{F as T}from"./FileSignatureIcon-DN6q7oyB.js";import{C as O}from"./CheckCircleIcon-aPMIrVJF.js";import{C as A}from"./CreditCardIcon-CrTjyf2t.js";const P=({data:s,color:x="#51D2EE",height:f=200})=>{var g,c,d;if(!s||s.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center text-gray-600 text-xs",children:"Sem dados suficientes"});const h=Math.max(...s.map(l=>l.value))||1,i=s.map((l,o)=>{const a=o/(s.length-1)*100,r=100-l.value/h*100;return`${a},${r}`}).join(" "),m=`0,100 ${i} 100,100`;return e.jsxs("div",{className:"w-full h-full relative group",children:[e.jsxs("svg",{viewBox:"0 0 100 100",preserveAspectRatio:"none",className:"w-full h-full overflow-visible",children:[e.jsx("line",{x1:"0",y1:"0",x2:"100",y2:"0",stroke:"#374151",strokeWidth:"0.5",strokeDasharray:"2"}),e.jsx("line",{x1:"0",y1:"50",x2:"100",y2:"50",stroke:"#374151",strokeWidth:"0.5",strokeDasharray:"2"}),e.jsx("line",{x1:"0",y1:"100",x2:"100",y2:"100",stroke:"#374151",strokeWidth:"0.5"}),e.jsx("polygon",{points:m,fill:x,fillOpacity:"0.1"}),e.jsx("polyline",{points:i,fill:"none",stroke:x,strokeWidth:"2",vectorEffect:"non-scaling-stroke"}),s.map((l,o)=>{const a=o/(s.length-1)*100,r=100-l.value/h*100;return e.jsx("circle",{cx:a,cy:r,r:"3",fill:x,className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",vectorEffect:"non-scaling-stroke",children:e.jsx("title",{children:`${l.fullDate}: ${l.value}`})},o)})]}),e.jsxs("div",{className:"flex justify-between mt-2 text-[10px] text-gray-500 font-mono",children:[e.jsx("span",{children:(g=s[0])==null?void 0:g.label}),e.jsx("span",{children:(c=s[Math.floor(s.length/2)])==null?void 0:c.label}),e.jsx("span",{children:(d=s[s.length-1])==null?void 0:d.label})]})]})},F=({data:s,color:x="#7942D8",height:f=200})=>{var c,d,l;if(!s||s.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center text-gray-600 text-xs",children:"Sem dados suficientes"});const h=Math.max(...s.map(o=>o.value))||1,i=100/s.length,m=.2*i,g=i-m;return e.jsxs("div",{className:"w-full h-full relative",children:[e.jsxs("svg",{viewBox:"0 0 100 100",preserveAspectRatio:"none",className:"w-full h-full overflow-visible",children:[e.jsx("line",{x1:"0",y1:"0",x2:"100",y2:"0",stroke:"#374151",strokeWidth:"0.5",strokeDasharray:"2"}),e.jsx("line",{x1:"0",y1:"50",x2:"100",y2:"50",stroke:"#374151",strokeWidth:"0.5",strokeDasharray:"2"}),e.jsx("line",{x1:"0",y1:"100",x2:"100",y2:"100",stroke:"#374151",strokeWidth:"0.5"}),s.map((o,a)=>{const r=o.value/h*100,n=a*i+m/2,b=100-r;return e.jsx("rect",{x:n,y:b,width:g,height:r,fill:x,className:"hover:opacity-80 transition-opacity",children:e.jsx("title",{children:`${o.fullDate}: ${o.value} usuários`})},a)})]}),e.jsxs("div",{className:"flex justify-between mt-2 text-[10px] text-gray-500 font-mono",children:[e.jsx("span",{children:(c=s[0])==null?void 0:c.label}),e.jsx("span",{children:(d=s[Math.floor(s.length/2)])==null?void 0:d.label}),e.jsx("span",{children:(l=s[s.length-1])==null?void 0:l.label})]})]})},Q=()=>{const[s,x]=p.useState({userCount:0,artistsCount:0,venuesCount:0,activeContractsCount:0,newUsers24h:0,grossVolume:0}),[f,h]=p.useState([]),[i,m]=p.useState({usersGrowth:[],revenueGrowth:[]}),[g,c]=p.useState(!0),[d,l]=p.useState(null),o=()=>{const a=[];for(let r=29;r>=0;r--){const n=new Date;n.setDate(n.getDate()-r),n.setHours(0,0,0,0),a.push(n)}return a};return p.useEffect(()=>{(async()=>{c(!0);try{const{data:r,error:n}=await w.from("usuarios").select("id, tipo, criado_em");if(n)throw n;const b=r.length,R=r.filter(t=>t.tipo==="artista").length,W=r.filter(t=>t.tipo==="estabelecimento").length,_=new Date,B=new Date(_.getTime()-1440*60*1e3),U=r.filter(t=>new Date(t.criado_em)>B).length,D=o(),L=D.map(t=>{const u=t.toISOString().split("T")[0],v=t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),N=r.filter(j=>j.criado_em.startsWith(u)).length;return{label:v,value:N,fullDate:t.toLocaleDateString("pt-BR")}}),{data:y,error:C}=await w.from("contratos").select("id, status, valor, taxa_servico, criado_em, data_pagamento");if(C)throw C;const V=y.filter(t=>["assinado","concluido"].includes(t.status)).length,$=y.reduce((t,u)=>t+(u.valor||0)+(u.taxa_servico||0),0),G=D.map(t=>{const u=t.toISOString().split("T")[0],v=t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),N=y.filter(j=>j.criado_em.startsWith(u)).reduce((j,k)=>j+(k.valor||0)+(k.taxa_servico||0),0);return{label:v,value:N,fullDate:t.toLocaleDateString("pt-BR")}});x({userCount:b,artistsCount:R,venuesCount:W,activeContractsCount:V,newUsers24h:U,grossVolume:$}),m({usersGrowth:L,revenueGrowth:G});const{data:I,error:S}=await w.from("usuarios").select("*, artista:artistas(*), estabelecimento:estabelecimentos(*)").order("criado_em",{ascending:!1}).limit(5);if(S)throw S;h((I||[]).map(t=>({...t,artista:Array.isArray(t.artista)?t.artista[0]:t.artista,estabelecimento:Array.isArray(t.estabelecimento)?t.estabelecimento[0]:t.estabelecimento})))}catch(r){console.error("Error fetching admin dashboard data:",r),l(M(r))}finally{c(!1)}})()},[]),g?e.jsx("div",{className:"text-white text-center p-8",children:"Carregando dashboard..."}):d?e.jsxs("div",{className:"text-red-400 text-center p-8",children:["Erro: ",d]}):e.jsxs("div",{className:"text-white animate-fade-in",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-primary font-poppins",children:"Painel Administrativo"}),e.jsx("p",{className:"text-gray-400 mb-8",children:"Visão geral do desempenho da plataforma RESONA."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm uppercase font-bold",children:"Total Usuários"}),e.jsx("h3",{className:"text-3xl font-bold text-white",children:s.userCount})]}),e.jsx("div",{className:"bg-blue-500/20 p-3 rounded-lg",children:e.jsx(E,{className:"w-6 h-6 text-blue-400"})})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 border-t border-gray-700 pt-2",children:[e.jsxs("span",{children:["Artistas: ",e.jsx("strong",{className:"text-white",children:s.artistsCount})]}),e.jsxs("span",{children:["Locais: ",e.jsx("strong",{className:"text-white",children:s.venuesCount})]})]})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm uppercase font-bold",children:"Novos (24h)"}),e.jsxs("h3",{className:"text-3xl font-bold text-green-400",children:["+",s.newUsers24h]})]}),e.jsx("div",{className:"bg-green-500/20 p-3 rounded-lg",children:e.jsx(O,{className:"w-6 h-6 text-green-400"})})]}),e.jsx("div",{className:"text-xs text-gray-400 border-t border-gray-700 pt-2",children:"Crescimento diário"})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm uppercase font-bold",children:"Contratos Ativos"}),e.jsx("h3",{className:"text-3xl font-bold text-white",children:s.activeContractsCount})]}),e.jsx("div",{className:"bg-purple-500/20 p-3 rounded-lg",children:e.jsx(T,{className:"w-6 h-6 text-purple-400"})})]}),e.jsx("div",{className:"text-xs text-gray-400 border-t border-gray-700 pt-2",children:"Assinados ou Concluídos"})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm uppercase font-bold",children:"Volume Total"}),e.jsxs("h3",{className:"text-3xl font-bold text-yellow-400",children:["R$ ",s.grossVolume.toLocaleString("pt-BR",{notation:"compact"})]})]}),e.jsx("div",{className:"bg-yellow-500/20 p-3 rounded-lg",children:e.jsx(A,{className:"w-6 h-6 text-yellow-400"})})]}),e.jsx("div",{className:"text-xs text-gray-400 border-t border-gray-700 pt-2",children:"Movimentado na plataforma"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-secondary"}),"Crescimento de Usuários (30 dias)"]}),e.jsx("div",{className:"h-64 w-full px-2",children:e.jsx(F,{data:i.usersGrowth,color:"#7942D8"})})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700 shadow-lg",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-primary"}),"Volume de Contratos (30 dias)"]}),e.jsx("div",{className:"h-64 w-full px-2",children:e.jsx(P,{data:i.revenueGrowth,color:"#51D2EE"})})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50",children:e.jsx("h3",{className:"font-bold text-white",children:"Usuários Recentes"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-900 text-gray-400 text-xs uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Nome"}),e.jsx("th",{className:"p-4",children:"Tipo"}),e.jsx("th",{className:"p-4",children:"Email"}),e.jsx("th",{className:"p-4",children:"Cidade"}),e.jsx("th",{className:"p-4",children:"Data Cadastro"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-700 text-sm",children:[f.map(a=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-4 font-bold text-white",children:a.nome}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs uppercase font-bold ${a.tipo==="artista"?"bg-blue-500/20 text-blue-300":"bg-purple-500/20 text-purple-300"}`,children:a.tipo})}),e.jsx("td",{className:"p-4 text-gray-300",children:a.email}),e.jsx("td",{className:"p-4 text-gray-300",children:a.cidade||"-"}),e.jsx("td",{className:"p-4 text-gray-400",children:new Date(a.criado_em).toLocaleDateString("pt-BR")})]},a.id)),f.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-8 text-center text-gray-500",children:"Nenhum usuário recente."})})]})]})})]})]})};export{Q as default};
