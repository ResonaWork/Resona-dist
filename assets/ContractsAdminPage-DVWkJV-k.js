import{b as v,j as e,C,c as S,e as k}from"./index-Cc-Lnn9x.js";import{r as l,j as A}from"./vendor-react-Dfcn4nkY.js";import{S as E}from"./SearchIcon-DH3o1suK.js";import{E as D}from"./EyeIcon-Bi_pvwfi.js";import{F as I}from"./FileSignatureIcon-CkuZe52x.js";import{C as F}from"./CheckCircleIcon-DMttEdVL.js";import{X as R}from"./XCircleIcon-D5u5_z3n.js";import{C as L}from"./ClockIcon-BsQhkGky.js";import"./vendor-jspdf-Bh_S0msn.js";import"./vendor-utils-DmyZJLyO.js";import"./vendor-ui-DKtFGipk.js";const _=({isOpen:m,onClose:p,contract:x,onRefresh:b})=>{var s,n;const[j,g]=l.useState(!1),[d,f]=l.useState(!1),[u,N]=l.useState(null);l.useEffect(()=>{m&&x&&y()},[m,x]);const y=async()=>{g(!0);try{const{data:r,error:w}=await v.from("contratos").select(`
                    *,
                    artistas(usuario_id, usuarios(nome, email, telefone)),
                    estabelecimentos(usuario_id, usuarios(nome, email, telefone))
                `).eq("id",x.id).single();r&&N(r)}catch(r){console.error(r)}finally{g(!1)}},h=async r=>{if(window.confirm(`ATENÇÃO: Você está prestes a forçar o status deste contrato para "${r.toUpperCase()}". Isso pode afetar fluxos de pagamento e notificações. Deseja continuar?`)){f(!0);try{await S.updateStatus(x.id,r),b(),p()}catch(w){alert("Erro ao atualizar: "+k(w))}finally{f(!1)}}};if(!m)return null;const t=u||x,i=Array.isArray(t.artistas)?t.artistas[0]:t.artistas,a=Array.isArray(t.estabelecimentos)?t.estabelecimentos[0]:t.estabelecimentos,c=Array.isArray(i==null?void 0:i.usuarios)?i==null?void 0:i.usuarios[0]:i==null?void 0:i.usuarios,o=Array.isArray(a==null?void 0:a.usuarios)?a==null?void 0:a.usuarios[0]:a==null?void 0:a.usuarios;return A.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:p}),e.jsxs("div",{className:"bg-gray-900 w-full max-w-4xl max-h-[90vh] rounded-2xl border border-gray-700 shadow-2xl relative z-10 flex flex-col overflow-hidden animate-fade-in-up",children:[e.jsxs("div",{className:"p-6 border-b border-gray-800 flex justify-between items-center bg-gray-850",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg text-primary",children:e.jsx(I,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:["Auditoria de Contrato",e.jsxs("span",{className:"text-xs font-mono text-gray-500 bg-gray-900 px-2 py-1 rounded border border-gray-700",children:["#",t.id.substring(0,8)]})]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Verifique os detalhes técnicos e force alterações de estado se necessário."})]})]}),e.jsx("button",{onClick:p,className:"text-gray-500 hover:text-white transition-colors",children:e.jsx(C,{})})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-6 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Status Atual"}),e.jsxs("div",{className:`mt-1 font-bold flex items-center gap-2 ${t.status==="concluido"?"text-green-400":t.status==="cancelado"?"text-red-400":"text-yellow-400"}`,children:[t.status==="concluido"?e.jsx(F,{className:"w-4 h-4"}):t.status==="cancelado"?e.jsx(R,{className:"w-4 h-4"}):e.jsx(L,{className:"w-4 h-4"}),t.status.toUpperCase()]})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Valor Acordado"}),e.jsxs("div",{className:"mt-1 font-mono text-white font-bold",children:["R$ ",(s=t.valor)==null?void 0:s.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Taxa Serviço (10%)"}),e.jsxs("div",{className:"mt-1 font-mono text-primary font-bold",children:["R$ ",(n=t.taxa_servico)==null?void 0:n.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Data Evento"}),e.jsx("div",{className:"mt-1 font-bold text-white",children:new Date(t.data_evento).toLocaleDateString()})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-xl border border-gray-700",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-300 mb-4 uppercase flex items-center gap-2 border-b border-gray-700 pb-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"})," Contratado (Artista)"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Nome:"})," ",e.jsx("span",{className:"text-white font-bold",children:(c==null?void 0:c.nome)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Email:"})," ",e.jsx("span",{className:"text-gray-300 font-mono",children:(c==null?void 0:c.email)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Telefone:"})," ",e.jsx("span",{className:"text-gray-300 font-mono",children:(c==null?void 0:c.telefone)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"ID Sistema:"})," ",e.jsx("span",{className:"text-gray-600 font-mono text-xs",children:t.artista_id})]})]})]}),e.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-xl border border-gray-700",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-300 mb-4 uppercase flex items-center gap-2 border-b border-gray-700 pb-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-purple-500"})," Contratante (Local)"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Nome:"})," ",e.jsx("span",{className:"text-white font-bold",children:(o==null?void 0:o.nome)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Email:"})," ",e.jsx("span",{className:"text-gray-300 font-mono",children:(o==null?void 0:o.email)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Telefone:"})," ",e.jsx("span",{className:"text-gray-300 font-mono",children:(o==null?void 0:o.telefone)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"ID Sistema:"})," ",e.jsx("span",{className:"text-gray-600 font-mono text-xs",children:t.estabelecimento_id})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Metadata Bruta (JSON)"}),e.jsx("div",{className:"bg-black p-4 rounded-xl border border-gray-800 font-mono text-[10px] text-green-500 overflow-x-auto max-h-40 custom-scrollbar",children:JSON.stringify(t,null,2)})]})]}),e.jsxs("div",{className:"p-6 bg-gray-850 border-t border-gray-800 flex justify-end gap-3",children:[t.status!=="cancelado"&&t.status!=="concluido"&&e.jsx("button",{onClick:()=>h("cancelado"),className:"bg-red-900/20 hover:bg-red-900/40 text-red-500 font-bold py-2 px-4 rounded-lg border border-red-900/30 transition-colors text-sm",disabled:d,children:"Forçar Cancelamento"}),t.status==="rascunho"&&e.jsx("button",{onClick:()=>h("assinado"),className:"bg-blue-900/20 hover:bg-blue-900/40 text-blue-400 font-bold py-2 px-4 rounded-lg border border-blue-900/30 transition-colors text-sm",disabled:d,children:"Forçar Assinatura"}),t.status==="assinado"&&e.jsx("button",{onClick:()=>h("concluido"),className:"bg-green-900/20 hover:bg-green-900/40 text-green-400 font-bold py-2 px-4 rounded-lg border border-green-900/30 transition-colors text-sm",disabled:d,children:"Forçar Conclusão (Pagamento)"})]})]})]}),document.body)},H=()=>{const[m,p]=l.useState([]),[x,b]=l.useState(!0),[j,g]=l.useState(null),[d,f]=l.useState(""),[u,N]=l.useState("all"),[y,h]=l.useState(!1),[t,i]=l.useState(null),a=l.useCallback(async()=>{b(!0),g(null);try{let s=v.from("contratos").select(`
                    *, 
                    artistas(usuario_id, usuarios(nome)), 
                    estabelecimentos(usuario_id, usuarios(nome))
                `).order("criado_em",{ascending:!1});u!=="all"&&(s=s.eq("status",u)),d&&d.match(/^[0-9a-f]{8}-/)&&(s=s.eq("id",d));const{data:n,error:r}=await s;if(r)throw r;p(n)}catch(s){g(k(s))}finally{b(!1)}},[d,u]);l.useEffect(()=>{a()},[a]);const c=s=>{i(s),h(!0)},o=s=>{const n=Array.isArray(s)?s[0]:s;if(!n)return"Desconhecido";const r=Array.isArray(n.usuarios)?n.usuarios[0]:n.usuarios;return(r==null?void 0:r.nome)||"Desconhecido"};return e.jsxs("div",{className:"text-white animate-fade-in pb-12",children:[e.jsxs("div",{className:"flex flex-col mb-12",children:[e.jsxs("h1",{className:"text-heading-hero mb-3 uppercase",children:["MOTOR ",e.jsx("span",{className:"text-primary italic",children:"JURÍDICO"})]}),e.jsx("p",{className:"text-section-label text-gray-500",children:"Ciclo de Vida de Contratos e Auditoria de Integridade"})]}),e.jsxs("div",{className:"glass-card p-6 rounded-3xl mb-12 border-white/5 shadow-2xl flex flex-col lg:flex-row items-center gap-6 group",children:[e.jsxs("div",{className:"relative flex-grow w-full lg:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Buscar por UUID...",value:d,onChange:s=>f(s.target.value),className:"w-full bg-white/5 border border-white/10 rounded-xl py-4 pl-12 pr-6 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white font-medium transition-all group-hover:bg-white/[0.08]"}),e.jsx(E,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"})]}),e.jsxs("div",{className:"flex items-center gap-4 w-full lg:w-auto overflow-x-auto",children:[e.jsxs("select",{value:u,onChange:s=>N(s.target.value),className:"bg-white/5 border border-white/10 rounded-xl py-4 px-6 text-[10px] font-black uppercase tracking-widest focus:outline-none focus:ring-2 focus:ring-primary/50 text-white cursor-pointer hover:bg-white/10 transition-all min-w-[200px]",children:[e.jsx("option",{value:"all",className:"bg-dark text-white",children:"Todos: Aberto"}),e.jsx("option",{value:"rascunho",className:"bg-dark text-white",children:"Status: Rascunho"}),e.jsx("option",{value:"enviado",className:"bg-dark text-white",children:"Status: Enviado"}),e.jsx("option",{value:"assinado",className:"bg-dark text-white",children:"Status: Assinado"}),e.jsx("option",{value:"concluido",className:"bg-dark text-white",children:"Status: Concluído"}),e.jsx("option",{value:"cancelado",className:"bg-dark text-white",children:"Status: Cancelado"})]}),e.jsx("button",{onClick:a,className:"text-[10px] font-black uppercase tracking-widest bg-white/5 px-8 py-4 rounded-xl border border-white/10 hover:bg-white/10 transition-all active:scale-95 flex items-center gap-3 shadow-lg",children:"Sincronizar Registros"})]})]}),j&&e.jsx("div",{className:"bg-red-500/20 text-red-400 p-4 rounded-lg mb-6 border border-red-500/30 text-center",children:j}),e.jsx("div",{className:"glass-card rounded-3xl border-white/5 overflow-hidden shadow-2xl",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-white/5 text-section-label text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-6 pl-10",children:"Hash ID"}),e.jsx("th",{className:"p-6",children:"Entidade Principal"}),e.jsx("th",{className:"p-6",children:"Contratante"}),e.jsx("th",{className:"p-6",children:"Data Evento"}),e.jsx("th",{className:"p-6 text-right",children:"Valor Bruto"}),e.jsx("th",{className:"p-6 text-center",children:"Status"}),e.jsx("th",{className:"p-6 text-right pr-10",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-white/[0.02]",children:x?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-24 text-center text-gray-600 font-black uppercase tracking-widest animate-pulse",children:"Filtrando Registros Jurídicos..."})}):m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-24 text-center text-gray-600 font-black uppercase tracking-widest leading-premium",children:"Nenhum registro correspondente."})}):m.map(s=>{var n;return e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors group",children:[e.jsxs("td",{className:"p-6 pl-10 font-mono text-[10px] text-gray-600",title:s.id,children:[s.id.substring(0,8),"..."]}),e.jsx("td",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-black text-white font-poppins tracking-tight leading-none group-hover:text-primary transition-colors uppercase",children:o(s.artistas)}),e.jsx("span",{className:"text-[9px] uppercase font-black tracking-[0.2em] text-gray-600 mt-1.5",children:"Artista Principal"})]})}),e.jsx("td",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-black text-gray-300 font-poppins tracking-tight leading-none uppercase",children:o(s.estabelecimentos)}),e.jsx("span",{className:"text-[9px] uppercase font-black tracking-[0.2em] text-gray-600 mt-1.5",children:"Estabelecimento Parceiro"})]})}),e.jsx("td",{className:"p-6 text-gray-400 font-mono text-xs",children:new Date(s.data_evento).toLocaleDateString("pt-BR")}),e.jsxs("td",{className:"p-6 text-right font-black text-white font-mono",children:[e.jsx("span",{className:"text-gray-600 text-[10px] mr-1",children:"R$"}),((n=s.valor)==null?void 0:n.toLocaleString("pt-BR",{minimumFractionDigits:2}))||"0,00"]}),e.jsx("td",{className:"p-6 text-center",children:e.jsx("span",{className:`px-4 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border
                                                ${s.status==="concluido"?"bg-green-500/10 text-green-400 border-green-500/20":s.status==="cancelado"?"bg-red-500/10 text-red-500 border-red-500/20":s.status==="assinado"?"bg-blue-500/10 text-blue-400 border-blue-500/20":"bg-yellow-500/10 text-yellow-400 border-yellow-500/20"}`,children:s.status})}),e.jsx("td",{className:"p-6 text-right pr-10",children:e.jsx("button",{onClick:()=>c(s),className:"w-10 h-10 flex items-center justify-center bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-white shadow-xl transition-all active:scale-90 group/btn",title:"Auditoria de Integridade",children:e.jsx(D,{className:"w-5 h-5 group-hover/btn:text-primary transition-colors"})})})]},s.id)})})]})})}),t&&e.jsx(_,{isOpen:y,onClose:()=>h(!1),contract:t,onRefresh:a})]})};export{H as default};
