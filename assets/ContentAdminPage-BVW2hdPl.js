import{r as s,d as P,s as p,e as R,j as a,C as H,G as z,b as J}from"./index-5Wja44cn.js";import{T as O}from"./TrashIcon-DmhbgFxo.js";import{C as K}from"./CheckCircleIcon-DnL8d6u2.js";import{C as Q}from"./ConfirmationModal-eTFt2h49.js";import"./ExclamationIcon-Db-Tesy4.js";const ie=()=>{var S,T,D,E,L,$;const[i,h]=s.useState("media"),[g,b]=s.useState([]),[y,v]=s.useState([]),[V,j]=s.useState(!0),[U,N]=s.useState(!1),[W,w]=s.useState(null),[x,X]=s.useState(""),[A,u]=s.useState(!1),[o,C]=s.useState(0),[q,f]=s.useState(!1),[d,_]=s.useState(null),[Y]=s.useState("terms"),k=s.useCallback(async()=>{j(!0),w(null);try{const{data:t}=await P.from("avaliacoes").select("id, nota, comentario, criado_em, avaliador:usuarios!avaliador_id (id, nome, foto_url), alvo:usuarios!alvo_id (id, nome, tipo)").lte("nota",2).order("criado_em",{ascending:!1}).limit(50);v((t||[]).map(e=>({...e,avaliador:Array.isArray(e.avaliador)?e.avaliador[0]:e.avaliador,alvo:Array.isArray(e.alvo)?e.alvo[0]:e.alvo})));const{data:n}=await P.from("usuarios").select("id, nome, tipo, foto_url, criado_em, artista:artistas(id, foto_capa, galeria_fotos), estabelecimento:estabelecimentos(id, foto_capa, galeria_fotos)").order("criado_em",{ascending:!1}).limit(40),r=[];(n||[]).forEach(e=>{e.foto_url&&r.push({id:`avatar-${e.id}`,url:p.getPublicUrl("perfis",e.foto_url),path:e.foto_url,type:"avatar",userId:e.id,userName:e.nome,userType:e.tipo,bucket:"perfis",createdAt:e.criado_em});const m=e.tipo==="artista"?Array.isArray(e.artista)?e.artista[0]:e.artista:Array.isArray(e.estabelecimento)?e.estabelecimento[0]:e.estabelecimento;m&&(m.foto_capa&&r.push({id:`cover-${e.id}`,url:p.getPublicUrl(e.tipo,m.foto_capa),path:m.foto_capa,type:"cover",userId:e.id,userName:e.nome,userType:e.tipo,bucket:e.tipo,createdAt:e.criado_em}),m.galeria_fotos&&m.galeria_fotos.forEach((F,G)=>r.push({id:`p-${e.id}-${G}`,url:p.getPublicUrl(e.tipo,F),path:F,type:"portfolio",userId:e.id,userName:e.nome,userType:e.tipo,bucket:e.tipo,createdAt:e.criado_em})))}),b(r)}catch(t){w(R(t))}finally{j(!1)}},[]);s.useEffect(()=>{k()},[k]);const I=async t=>{if(!(!t||t.aiAnalysis))if(i==="media"){const n=await z.analyzeImage(t.url);b(r=>r.map(e=>e.id===t.id?{...e,aiAnalysis:n}:e))}else{const n=await z.analyzeComment(t.comentario);v(r=>r.map(e=>e.id===t.id?{...e,aiAnalysis:n}:e))}},M=()=>{const t=i==="media"?l:c;o<t.length-1?(C(o+1),I(t[o+1])):u(!1)},B=async()=>{if(d){N(!0);try{try{await p.remove(d.bucket,[d.path])}catch{}d.type==="avatar"&&await J.updateBasicInfo(d.userId,{foto_url:null}),b(t=>t.filter(n=>n.id!==d.id)),f(!1),A&&M()}catch(t){alert(R(t))}finally{N(!1)}}},l=g.filter(t=>!x||t.userName.toLowerCase().includes(x.toLowerCase())),c=y.filter(t=>!x||t.comentario.toLowerCase().includes(x.toLowerCase()));return a.jsxs("div",{className:"text-white animate-fade-in pb-20",children:[A&&a.jsxs("div",{className:"fixed inset-0 z-[100] bg-gray-900 flex flex-col animate-fade-in",children:[a.jsxs("div",{className:"h-14 bg-gray-800 border-b border-gray-700 flex items-center justify-between px-4 shrink-0",children:[a.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-white",children:a.jsx(H,{})}),a.jsxs("h2",{className:"font-bold text-lg",children:["Modo Foco ⚡ (",o+1,"/",(i==="media"?l:c).length,")"]}),a.jsx("div",{className:"w-10"})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsx("div",{className:"flex-1 bg-black flex items-center justify-center p-4",children:i==="media"?a.jsx("img",{src:(S=l[o])==null?void 0:S.url,className:"max-w-full max-h-full object-contain"}):a.jsxs("div",{className:"max-w-2xl bg-gray-800 p-8 rounded-xl border border-gray-700",children:['"',(T=c[o])==null?void 0:T.comentario,'"']})}),a.jsxs("div",{className:"w-80 bg-gray-800 border-l border-gray-700 p-6 space-y-6",children:[a.jsxs("div",{className:"p-4 rounded-lg bg-gray-900 border border-gray-700",children:[a.jsx("p",{className:"text-[10px] font-black uppercase text-primary mb-1",children:"IA Auditor"}),a.jsx("p",{className:"text-sm text-gray-400",children:(i==="media"?(E=(D=l[o])==null?void 0:D.aiAnalysis)==null?void 0:E.reason:($=(L=c[o])==null?void 0:L.aiAnalysis)==null?void 0:$.reason)||"Analisando..."})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("button",{onClick:()=>{i==="media"&&(_(l[o]),f(!0))},className:"bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg flex flex-col items-center gap-1",children:[a.jsx(O,{className:"w-6 h-6"}),a.jsx("span",{className:"text-xs font-bold",children:"Delete"})]}),a.jsxs("button",{onClick:M,className:"bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg flex flex-col items-center gap-1",children:[a.jsx(K,{className:"w-6 h-6"}),a.jsx("span",{className:"text-xs font-bold",children:"Approve"})]})]})]})]})]}),a.jsxs("div",{className:"flex justify-between items-center mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-primary font-poppins",children:"Auditoria de Conteúdo"}),a.jsx("button",{onClick:()=>{C(0),u(!0),I(i==="media"?l[0]:c[0])},className:"bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-2 px-6 rounded-full flex items-center gap-2",children:"⚡ Iniciar Moderação"})]}),a.jsxs("div",{className:"flex border-b border-gray-700 mb-6",children:[a.jsxs("button",{onClick:()=>h("media"),className:`px-6 py-3 text-sm font-bold border-b-2 ${i==="media"?"border-primary text-white":"border-transparent text-gray-400"}`,children:["Mídia (",g.length,")"]}),a.jsxs("button",{onClick:()=>h("reviews"),className:`px-6 py-3 text-sm font-bold border-b-2 ${i==="reviews"?"border-primary text-white":"border-transparent text-gray-400"}`,children:["Avaliações (",y.length,")"]})]}),a.jsx("div",{className:"bg-gray-800 p-6 rounded-xl border border-gray-700",children:i==="media"?a.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 gap-4",children:l.map(t=>a.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-700 group",children:[a.jsx("img",{src:t.url,className:"w-full h-full object-cover blur-sm hover:blur-0 transition-all"}),a.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-2 transition-opacity",children:a.jsx("button",{onClick:()=>{_(t),f(!0)},className:"p-2 bg-red-600 rounded-full text-white",children:a.jsx(O,{className:"w-4 h-4"})})})]},t.id))}):a.jsx("div",{className:"space-y-4",children:c.map(t=>a.jsxs("div",{className:"p-4 bg-gray-900 rounded-lg border-l-4 border-red-500 flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"font-bold text-white",children:[t.avaliador.nome," → ",t.alvo.nome]}),a.jsxs("p",{className:"text-gray-400 text-sm italic",children:['"',t.comentario,'"']})]}),a.jsx("span",{className:"text-2xl font-black text-red-400",children:t.nota})]},t.id))})}),a.jsx(Q,{isOpen:q,onClose:()=>f(!1),onConfirm:B,title:"Confirmar Deleção",message:a.jsx("p",{children:"Excluir esta mídia permanentemente?"}),confirmText:"Excluir",isConfirming:U})]})};export{ie as default};
