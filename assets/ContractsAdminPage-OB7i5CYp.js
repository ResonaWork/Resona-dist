import{b as w,j as e,C as A,c as S,e as C}from"./index-DlAvHY7j.js";import{r as o,j as k}from"./vendor-react-Dfcn4nkY.js";import{S as D}from"./SearchIcon-BYpUjHCe.js";import{E}from"./EyeIcon-CgRAIkQd.js";import{F as I}from"./FileSignatureIcon-YqVRZMe_.js";import{C as F}from"./CheckCircleIcon-ChAVo4Go.js";import{X as L}from"./XCircleIcon-BlnaoKfv.js";import{C as _}from"./ClockIcon-BbwtPucJ.js";import"./vendor-jspdf-Bh_S0msn.js";import"./vendor-utils-DmyZJLyO.js";import"./vendor-ui-DKtFGipk.js";const R=({isOpen:m,onClose:h,contract:x,onRefresh:b})=>{var s,n;const[j,p]=o.useState(!1),[c,f]=o.useState(!1),[u,y]=o.useState(null);o.useEffect(()=>{m&&x&&N()},[m,x]);const N=async()=>{p(!0);try{const{data:r,error:v}=await w.from("contratos").select(`
                    *,
                    artistas(usuario_id, usuarios(nome, email, telefone)),
                    estabelecimentos(usuario_id, usuarios(nome, email, telefone))
                `).eq("id",x.id).single();r&&y(r)}catch(r){console.error(r)}finally{p(!1)}},g=async r=>{if(window.confirm(`ATENÇÃO: Você está prestes a forçar o status deste contrato para "${r.toUpperCase()}". Isso pode afetar fluxos de pagamento e notificações. Deseja continuar?`)){f(!0);try{await S.updateStatus(x.id,r),b(),h()}catch(v){alert("Erro ao atualizar: "+C(v))}finally{f(!1)}}};if(!m)return null;const a=u||x,i=Array.isArray(a.artistas)?a.artistas[0]:a.artistas,t=Array.isArray(a.estabelecimentos)?a.estabelecimentos[0]:a.estabelecimentos,d=Array.isArray(i==null?void 0:i.usuarios)?i==null?void 0:i.usuarios[0]:i==null?void 0:i.usuarios,l=Array.isArray(t==null?void 0:t.usuarios)?t==null?void 0:t.usuarios[0]:t==null?void 0:t.usuarios;return k.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:h}),e.jsxs("div",{className:"bg-gray-900 w-full max-w-4xl max-h-[90vh] rounded-2xl border border-gray-700 shadow-2xl relative z-10 flex flex-col overflow-hidden animate-fade-in-up",children:[e.jsxs("div",{className:"p-6 border-b border-gray-800 flex justify-between items-center bg-gray-850",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg text-primary",children:e.jsx(I,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:["Auditoria de Contrato",e.jsxs("span",{className:"text-xs font-mono text-gray-500 bg-gray-900 px-2 py-1 rounded border border-gray-700",children:["#",a.id.substring(0,8)]})]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Verifique os detalhes técnicos e force alterações de estado se necessário."})]})]}),e.jsx("button",{onClick:h,className:"text-gray-500 hover:text-white transition-colors",children:e.jsx(A,{})})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-6 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Status Atual"}),e.jsxs("div",{className:`mt-1 font-bold flex items-center gap-2 ${a.status==="concluido"?"text-green-400":a.status==="cancelado"?"text-red-400":"text-yellow-400"}`,children:[a.status==="concluido"?e.jsx(F,{className:"w-4 h-4"}):a.status==="cancelado"?e.jsx(L,{className:"w-4 h-4"}):e.jsx(_,{className:"w-4 h-4"}),a.status.toUpperCase()]})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Valor Acordado"}),e.jsxs("div",{className:"mt-1 font-mono text-white font-bold",children:["R$ ",(s=a.valor)==null?void 0:s.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Taxa Serviço (10%)"}),e.jsxs("div",{className:"mt-1 font-mono text-primary font-bold",children:["R$ ",(n=a.taxa_servico)==null?void 0:n.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase font-bold",children:"Data Evento"}),e.jsx("div",{className:"mt-1 font-bold text-white",children:new Date(a.data_evento).toLocaleDateString()})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-xl border border-gray-700",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-300 mb-4 uppercase flex items-center gap-2 border-b border-gray-700 pb-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"})," Contratado (Artista)"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Nome:"})," ",e.jsx("span",{className:"text-white font-bold",children:(d==null?void 0:d.nome)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Email:"})," ",e.jsx("span",{className:"text-gray-300 font-mono",children:(d==null?void 0:d.email)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Telefone:"})," ",e.jsx("span",{className:"text-gray-300 font-mono",children:(d==null?void 0:d.telefone)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"ID Sistema:"})," ",e.jsx("span",{className:"text-gray-600 font-mono text-xs",children:a.artista_id})]})]})]}),e.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-xl border border-gray-700",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-300 mb-4 uppercase flex items-center gap-2 border-b border-gray-700 pb-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-purple-500"})," Contratante (Local)"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Nome:"})," ",e.jsx("span",{className:"text-white font-bold",children:(l==null?void 0:l.nome)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Email:"})," ",e.jsx("span",{className:"text-gray-300 font-mono",children:(l==null?void 0:l.email)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"Telefone:"})," ",e.jsx("span",{className:"text-gray-300 font-mono",children:(l==null?void 0:l.telefone)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block text-xs",children:"ID Sistema:"})," ",e.jsx("span",{className:"text-gray-600 font-mono text-xs",children:a.estabelecimento_id})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Metadata Bruta (JSON)"}),e.jsx("div",{className:"bg-black p-4 rounded-xl border border-gray-800 font-mono text-[10px] text-green-500 overflow-x-auto max-h-40 custom-scrollbar",children:JSON.stringify(a,null,2)})]})]}),e.jsxs("div",{className:"p-6 bg-gray-850 border-t border-gray-800 flex justify-end gap-3",children:[a.status!=="cancelado"&&a.status!=="concluido"&&e.jsx("button",{onClick:()=>g("cancelado"),className:"bg-red-900/20 hover:bg-red-900/40 text-red-500 font-bold py-2 px-4 rounded-lg border border-red-900/30 transition-colors text-sm",disabled:c,children:"Forçar Cancelamento"}),a.status==="rascunho"&&e.jsx("button",{onClick:()=>g("assinado"),className:"bg-blue-900/20 hover:bg-blue-900/40 text-blue-400 font-bold py-2 px-4 rounded-lg border border-blue-900/30 transition-colors text-sm",disabled:c,children:"Forçar Assinatura"}),a.status==="assinado"&&e.jsx("button",{onClick:()=>g("concluido"),className:"bg-green-900/20 hover:bg-green-900/40 text-green-400 font-bold py-2 px-4 rounded-lg border border-green-900/30 transition-colors text-sm",disabled:c,children:"Forçar Conclusão (Pagamento)"})]})]})]}),document.body)},G=()=>{const[m,h]=o.useState([]),[x,b]=o.useState(!0),[j,p]=o.useState(null),[c,f]=o.useState(""),[u,y]=o.useState("all"),[N,g]=o.useState(!1),[a,i]=o.useState(null),t=o.useCallback(async()=>{b(!0),p(null);try{let s=w.from("contratos").select(`
                    *, 
                    artistas(usuario_id, usuarios(nome)), 
                    estabelecimentos(usuario_id, usuarios(nome))
                `).order("criado_em",{ascending:!1});u!=="all"&&(s=s.eq("status",u)),c&&c.match(/^[0-9a-f]{8}-/)&&(s=s.eq("id",c));const{data:n,error:r}=await s;if(r)throw r;h(n)}catch(s){p(C(s))}finally{b(!1)}},[c,u]);o.useEffect(()=>{t()},[t]);const d=s=>{i(s),g(!0)},l=s=>{const n=Array.isArray(s)?s[0]:s;if(!n)return"Desconhecido";const r=Array.isArray(n.usuarios)?n.usuarios[0]:n.usuarios;return(r==null?void 0:r.nome)||"Desconhecido"};return e.jsxs("div",{className:"text-white animate-fade-in",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-primary font-poppins",children:"Gestão de Contratos"}),e.jsx("p",{className:"text-gray-400 mb-8",children:"Monitore e audite todos os contratos gerados na plataforma."}),e.jsxs("div",{className:"bg-gray-800 p-5 rounded-xl mb-8 border border-gray-700 shadow-md flex flex-col lg:flex-row items-center gap-4",children:[e.jsxs("div",{className:"relative flex-grow w-full lg:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Buscar por ID exato (UUID)...",value:c,onChange:s=>f(s.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-primary text-white"}),e.jsx(D,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"})]}),e.jsx("div",{className:"flex items-center gap-2 w-full lg:w-auto",children:e.jsxs("select",{value:u,onChange:s=>y(s.target.value),className:"bg-gray-900 border border-gray-600 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-primary text-white w-full lg:w-auto",children:[e.jsx("option",{value:"all",children:"Todos os Status"}),e.jsx("option",{value:"rascunho",children:"Rascunho"}),e.jsx("option",{value:"enviado",children:"Aguardando Assinatura"}),e.jsx("option",{value:"assinado",children:"Assinado"}),e.jsx("option",{value:"concluido",children:"Concluído (Pago)"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})}),e.jsx("button",{onClick:t,className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors",children:"Atualizar"})]}),j&&e.jsx("div",{className:"bg-red-500/20 text-red-400 p-4 rounded-lg mb-6 border border-red-500/30 text-center",children:j}),e.jsx("div",{className:"bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-900 text-gray-400 text-xs uppercase font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"ID"}),e.jsx("th",{className:"p-4",children:"Artista"}),e.jsx("th",{className:"p-4",children:"Contratante"}),e.jsx("th",{className:"p-4",children:"Data Evento"}),e.jsx("th",{className:"p-4 text-right",children:"Valor"}),e.jsx("th",{className:"p-4 text-center",children:"Status"}),e.jsx("th",{className:"p-4 text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700 text-sm",children:x?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-8 text-center text-gray-500",children:"Carregando contratos..."})}):m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-8 text-center text-gray-500",children:"Nenhum contrato encontrado."})}):m.map(s=>{var n;return e.jsxs("tr",{className:"hover:bg-gray-700/30 transition-colors",children:[e.jsxs("td",{className:"p-4 font-mono text-xs text-gray-500",title:s.id,children:[s.id.substring(0,8),"..."]}),e.jsx("td",{className:"p-4 font-medium text-white",children:l(s.artistas)}),e.jsx("td",{className:"p-4 text-gray-300",children:l(s.estabelecimentos)}),e.jsx("td",{className:"p-4 text-gray-300",children:new Date(s.data_evento).toLocaleDateString()}),e.jsxs("td",{className:"p-4 text-right font-mono",children:["R$ ",((n=s.valor)==null?void 0:n.toLocaleString("pt-BR",{minimumFractionDigits:2}))||"0,00"]}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase 
                                                ${s.status==="concluido"?"bg-green-500/20 text-green-300":s.status==="cancelado"?"bg-red-500/20 text-red-300":s.status==="assinado"?"bg-blue-500/20 text-blue-300":"bg-yellow-500/20 text-yellow-300"}`,children:s.status})}),e.jsx("td",{className:"p-4 text-right",children:e.jsx("button",{onClick:()=>d(s),className:"p-2 text-blue-400 hover:text-white hover:bg-blue-600/20 rounded transition-colors",title:"Auditar Contrato",children:e.jsx(E,{className:"w-5 h-5"})})})]},s.id)})})]})})}),a&&e.jsx(R,{isOpen:N,onClose:()=>g(!1),contract:a,onRefresh:t})]})};export{G as default};
