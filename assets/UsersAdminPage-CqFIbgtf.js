import{b as v,o as z,e as w,j as e,s as S,C as B}from"./index-BhcEfvUj.js";import{r}from"./vendor-react-Dfcn4nkY.js";import{S as D}from"./SearchIcon-BuX9Sfv1.js";import{C as G}from"./CheckCircleIcon-CrC6G3lk.js";import{X as H}from"./XCircleIcon-BYErfyVE.js";import{E as R}from"./EyeIcon-CkWKZ3At.js";import{S as X}from"./SparklesIcon-DrPl16yt.js";import{T as Z}from"./TrophyIcon-DqMVrQZi.js";import"./vendor-pdf-DHYqqgbQ.js";import"./vendor-utils-DmyZJLyO.js";import"./vendor-ui-DKtFGipk.js";const n=10,Q=l=>{let o=0;return l.nome&&l.nome!=="Usuário"&&(o+=25),l.cidade&&(o+=25),l.telefone&&(o+=20),l.foto_url&&(o+=30),o},ce=()=>{const[l,o]=r.useState([]),[C,f]=r.useState(!0),[V,k]=r.useState(null),[u,j]=r.useState(null),[h,_]=r.useState(""),[i,I]=r.useState(""),[x,U]=r.useState(""),[m,E]=r.useState("all"),[d,g]=r.useState(0),[p,P]=r.useState(null),[c,T]=r.useState(null),[A,b]=r.useState(!1);r.useEffect(()=>{const s=setTimeout(()=>{I(h),g(0)},500);return()=>clearTimeout(s)},[h]);const y=r.useCallback(async()=>{f(!0);const s=d*n,a=s+n-1;try{let t=v.from("usuarios").select("*, artista:artistas(*), estabelecimento:estabelecimentos(*)",{count:"exact"});i&&(t=t.or(`nome.ilike.%${i}%,email.ilike.%${i}%`)),x&&(t=t.eq("tipo",x)),m==="suspended"?t=t.eq("is_suspended",!0):m==="active"&&(t=t.eq("is_suspended",!1));const{data:F,count:O,error:N}=await t.order("criado_em",{ascending:!1}).range(s,a);if(N)throw N;const L=(F||[]).map(M=>z(M));o(L),P(O)}catch(t){k(w(t))}finally{f(!1)}},[d,i,x,m]);r.useEffect(()=>{y()},[y]);const q=async s=>{try{const{error:a}=await v.from("usuarios").update({is_suspended:!s.is_suspended}).eq("id",s.id);if(a)throw a;o(l.map(t=>t.id===s.id?{...t,is_suspended:!t.is_suspended}:t)),j({message:`Usuário ${s.is_suspended?"ativado":"suspenso"} com sucesso.`,type:"success"})}catch(a){j({message:"Erro ao atualizar status: "+w(a),type:"error"})}},$=s=>{T(s),b(!0)};return e.jsxs("div",{className:"text-white animate-fade-in relative pb-20",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-primary font-poppins",children:"Gestão de Usuários"}),e.jsx("p",{className:"text-gray-400 mb-8",children:"Administração da base e moderação de perfis."}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700 mb-6 flex flex-col md:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-grow w-full",children:[e.jsx("input",{type:"text",placeholder:"Buscar por nome ou email...",value:h,onChange:s=>_(s.target.value),className:"w-full bg-gray-900 border border-gray-700 rounded-lg py-2 pl-10 pr-4 text-sm"}),e.jsx(D,{className:"absolute left-3 top-2.5 w-4 h-4 text-gray-500"})]}),e.jsxs("select",{value:x,onChange:s=>U(s.target.value),className:"bg-gray-900 border border-gray-700 rounded-lg py-2 px-4 text-sm w-full md:w-auto",children:[e.jsx("option",{value:"",children:"Todos os Tipos"}),e.jsx("option",{value:"artista",children:"Artistas"}),e.jsx("option",{value:"estabelecimento",children:"Locais"})]}),e.jsxs("select",{value:m,onChange:s=>E(s.target.value),className:"bg-gray-900 border border-gray-700 rounded-lg py-2 px-4 text-sm w-full md:w-auto",children:[e.jsx("option",{value:"all",children:"Qualquer Status"}),e.jsx("option",{value:"active",children:"Ativos"}),e.jsx("option",{value:"suspended",children:"Suspensos"})]})]}),u&&e.jsx("div",{className:`p-3 rounded-md mb-6 text-center text-sm ${u.type==="success"?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-400"}`,children:u.message}),e.jsxs("div",{className:"bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-900/80 border-b border-gray-700 text-gray-400 text-[10px] uppercase font-black",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Usuário"}),e.jsx("th",{className:"p-4",children:"Plano"}),e.jsx("th",{className:"p-4",children:"Health Score"}),e.jsx("th",{className:"p-4 text-center",children:"Status"}),e.jsx("th",{className:"p-4 text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:C?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-10 text-center text-gray-500",children:"Buscando usuários..."})}):l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-10 text-center text-gray-500",children:"Nenhum usuário encontrado."})}):l.map(s=>{const a=Q(s);return e.jsxs("tr",{className:"hover:bg-gray-700/30 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 border border-gray-600 flex items-center justify-center overflow-hidden",children:s.foto_url?e.jsx("img",{src:S.getPublicUrl("perfis",s.foto_url),className:"w-full h-full object-cover"}):s.nome.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-white",children:s.nome}),e.jsx("p",{className:"text-xs text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"p-4",children:s.plano==="pro"?e.jsxs("span",{className:"flex items-center gap-1 text-[10px] font-black text-primary bg-primary/10 px-2 py-0.5 rounded border border-primary/20",children:[e.jsx(X,{className:"w-3 h-3"})," PRO"]}):s.plano==="business"?e.jsxs("span",{className:"flex items-center gap-1 text-[10px] font-black text-yellow-500 bg-yellow-500/10 px-2 py-0.5 rounded border border-yellow-500/20",children:[e.jsx(Z,{className:"w-3 h-3"})," BIZ"]}):e.jsx("span",{className:"text-[10px] text-gray-500 font-bold uppercase",children:"Free"})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"w-24",children:[e.jsx("div",{className:"h-1.5 w-full bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${a>70?"bg-green-500":a>40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${a}%`}})}),e.jsxs("span",{className:"text-[9px] text-gray-500 mt-1 block uppercase font-bold",children:[a,"% Completo"]})]})}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded border ${s.is_suspended?"bg-red-500/20 text-red-400 border-red-500/30":"bg-green-500/20 text-green-400 border-green-500/30"}`,children:s.is_suspended?"SUSPENSO":"ATIVO"})}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>$(s),className:"p-2 text-gray-400 hover:text-white",title:"Inspecionar",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(s),className:`p-2 rounded ${s.is_suspended?"text-green-400 hover:bg-green-500/10":"text-red-400 hover:bg-red-500/10"}`,children:s.is_suspended?e.jsx(G,{className:"w-4 h-4"}):e.jsx(H,{className:"w-4 h-4"})})]})})]},s.id)})})]})}),p!==null&&p>n&&e.jsxs("div",{className:"p-4 bg-gray-900 border-t border-gray-700 flex justify-between items-center text-xs text-gray-400",children:[e.jsxs("span",{children:["Página ",d+1," de ",Math.ceil(p/n)]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:d===0,onClick:()=>g(s=>s-1),className:"px-3 py-1 bg-gray-800 rounded disabled:opacity-50",children:"Anterior"}),e.jsx("button",{disabled:(d+1)*n>=p,onClick:()=>g(s=>s+1),className:"px-3 py-1 bg-gray-800 rounded disabled:opacity-50",children:"Próxima"})]})]})]}),A&&c&&e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[100] flex justify-center items-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl border border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50",children:[e.jsx("h2",{className:"font-bold text-lg",children:"Inspecionar Usuário"}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-500 hover:text-white",children:e.jsx(B,{})})]}),e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"flex gap-6 items-center",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-700 border-4 border-gray-600 overflow-hidden",children:c.foto_url?e.jsx("img",{src:S.getPublicUrl("perfis",c.foto_url),className:"w-full h-full object-cover"}):null}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:c.nome}),e.jsx("p",{className:"text-primary font-bold uppercase text-xs",children:c.tipo}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:c.email})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase font-black",children:"Localização"}),e.jsx("p",{className:"text-sm font-medium",children:c.cidade||"Não informada"})]}),e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase font-black",children:"Cadastro"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(c.criado_em).toLocaleDateString()})]})]})]}),e.jsx("div",{className:"p-4 bg-gray-900/50 flex justify-end",children:e.jsx("button",{onClick:()=>b(!1),className:"px-6 py-2 bg-gray-700 rounded-lg text-white font-bold",children:"Fechar"})})]})})]})};export{ce as default};
