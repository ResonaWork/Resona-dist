import{b as ce,s as b,e as xe,j as e,C as ge,w as me,a as ve}from"./index-B3LDTW8P.js";import{r as l}from"./vendor-react-Dfcn4nkY.js";import{P as ye}from"./PhotographIcon-CbjgoHuu.js";import{T as pe}from"./TrashIcon-DZaGTioq.js";import{C as we}from"./CheckCircleIcon-B-pqGhzV.js";import{C as je}from"./ConfirmationModal-B5EtYYGl.js";import"./vendor-jspdf-Bh_S0msn.js";import"./vendor-utils-DmyZJLyO.js";import"./vendor-ui-DKtFGipk.js";import"./ExclamationIcon-Bo2WpRJi.js";const Le=()=>{var M,T,E,$,D,P,R,L,z,F,B,O,U,W,q,G,H,J,K,Q,V,X,Y,Z,ee,ae,te,se,ie,re,oe,le,ne;const[i,v]=l.useState("media"),[y,u]=l.useState([]),[w,j]=l.useState([]),[Ne,N]=l.useState(!0),[he,k]=l.useState(!1),[ke,A]=l.useState(null),[m,Ae]=l.useState(""),[p,g]=l.useState(!1),[s,h]=l.useState(0),[fe,f]=l.useState(!1),[c,_]=l.useState(null),[_e]=l.useState("terms"),C=l.useCallback(async()=>{N(!0),A(null);try{const{data:t}=await ce.from("avaliacoes").select("id, nota, comentario, criado_em, avaliador:usuarios!avaliador_id (id, nome, foto_url), alvo:usuarios!alvo_id (id, nome, tipo)").lte("nota",2).order("criado_em",{ascending:!1}).limit(50);j((t||[]).map(a=>({...a,avaliador:Array.isArray(a.avaliador)?a.avaliador[0]:a.avaliador,alvo:Array.isArray(a.alvo)?a.alvo[0]:a.alvo})));const{data:d}=await ce.from("usuarios").select("id, nome, tipo, foto_url, criado_em, artista:artistas(id, foto_capa, galeria_fotos), estabelecimento:estabelecimentos(id, foto_capa, galeria_fotos)").order("criado_em",{ascending:!1}).limit(40),n=[];(d||[]).forEach(a=>{a.foto_url&&n.push({id:`avatar-${a.id}`,url:b.getPublicUrl("perfis",a.foto_url),path:a.foto_url,type:"avatar",userId:a.id,userName:a.nome,userType:a.tipo,bucket:"perfis",createdAt:a.criado_em});const x=a.tipo==="artista"?Array.isArray(a.artista)?a.artista[0]:a.artista:Array.isArray(a.estabelecimento)?a.estabelecimento[0]:a.estabelecimento;x&&(x.foto_capa&&n.push({id:`cover-${a.id}`,url:b.getPublicUrl(a.tipo,x.foto_capa),path:x.foto_capa,type:"cover",userId:a.id,userName:a.nome,userType:a.tipo,bucket:a.tipo,createdAt:a.criado_em}),x.galeria_fotos&&x.galeria_fotos.forEach((de,ue)=>n.push({id:`p-${a.id}-${ue}`,url:b.getPublicUrl(a.tipo,de),path:de,type:"portfolio",userId:a.id,userName:a.nome,userType:a.tipo,bucket:a.tipo,createdAt:a.criado_em})))}),u(n)}catch(t){A(xe(t))}finally{N(!1)}},[]);l.useEffect(()=>{C()},[C]),l.useEffect(()=>(p?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[p]);const S=async t=>{if(!(!t||t.aiAnalysis))if(i==="media"){const d=await me.analyzeImage(t.url);u(n=>n.map(a=>a.id===t.id?{...a,aiAnalysis:d}:a))}else{const d=await me.analyzeComment(t.comentario);j(n=>n.map(a=>a.id===t.id?{...a,aiAnalysis:d}:a))}},I=()=>{const t=i==="media"?r:o;s<t.length-1?(h(s+1),S(t[s+1])):g(!1)},be=async()=>{if(c){k(!0);try{try{await b.remove(c.bucket,[c.path])}catch{}c.type==="avatar"&&await ve.updateBasicInfo(c.userId,{foto_url:null}),u(t=>t.filter(d=>d.id!==c.id)),f(!1),p&&I()}catch(t){alert(xe(t))}finally{k(!1)}}},r=y.filter(t=>!m||t.userName.toLowerCase().includes(m.toLowerCase())),o=w.filter(t=>!m||t.comentario.toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{className:"text-white animate-fade-in pb-20",children:[p&&e.jsxs("div",{className:"fixed inset-0 z-[999] bg-[#050505] flex animate-fade-in overflow-hidden h-screen w-screen font-sans",children:[e.jsx("div",{className:`absolute inset-0 opacity-20 transition-colors duration-700 blur-[120px] pointer-events-none ${(i==="media"?(T=(M=r[s])==null?void 0:M.aiAnalysis)!=null&&T.isSafe:!(($=(E=o[s])==null?void 0:E.aiAnalysis)!=null&&$.isToxic))?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{className:"flex-1 relative flex flex-col overflow-hidden z-10",children:[e.jsxs("div",{className:"p-8 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>g(!1),className:"group flex items-center gap-3 text-gray-400 hover:text-white transition-all bg-white/5 px-4 py-2 rounded-full border border-white/5 backdrop-blur-md",children:[e.jsx(ge,{className:"w-5 h-5 group-hover:rotate-90 transition-transform"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-white/50",children:"Sair do Foco"})]}),e.jsxs("div",{className:"flex items-center gap-6 bg-white/5 backdrop-blur-md px-6 py-2 rounded-full border border-white/5",children:[e.jsx("button",{onClick:()=>h(Math.max(0,s-1)),disabled:s===0,className:"text-gray-400 hover:text-white disabled:opacity-20 transition-all p-1",children:e.jsx("svg",{className:"w-6 h-6 rotate-180",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M9 5l7 7-7 7"})})}),e.jsxs("div",{className:"text-center min-w-[100px]",children:[e.jsx("div",{className:"text-[10px] text-gray-500 font-black uppercase tracking-tighter mb-0.5",children:"Progresso"}),e.jsxs("div",{className:"text-sm font-mono font-bold text-white leading-none",children:[String(s+1).padStart(2,"0")," ",e.jsx("span",{className:"text-gray-600",children:"/"})," ",String((i==="media"?r:o).length).padStart(2,"0")]})]}),e.jsx("button",{onClick:()=>h(Math.min((i==="media"?r:o).length-1,s+1)),disabled:s===(i==="media"?r:o).length-1,className:"text-gray-400 hover:text-white disabled:opacity-20 transition-all p-1",children:e.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"w-32"})," "]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-6 md:p-12 mb-8",children:i==="media"?e.jsxs("div",{className:"relative group max-w-full max-h-full",children:[e.jsx("div",{className:"absolute -inset-4 bg-white/5 rounded-[40px] blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),e.jsx("img",{src:(D=r[s])==null?void 0:D.url,className:"relative z-10 max-w-full max-h-[80vh] object-contain rounded-2xl shadow-[0_32px_64px_-16px_rgba(0,0,0,0.8)] border border-white/10",alt:"Audit"})]}):e.jsxs("div",{className:"max-w-3xl w-full p-16 bg-white/[0.03] backdrop-blur-2xl rounded-[40px] border border-white/10 shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-2 h-full bg-primary"}),e.jsxs("p",{className:"text-3xl md:text-4xl text-white leading-relaxed font-serif italic mb-8",children:['"',(P=o[s])==null?void 0:P.comentario,'"']}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-tr from-primary to-secondary flex items-center justify-center text-white font-bold shadow-lg",children:(R=o[s])==null?void 0:R.avaliador.nome.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white text-lg",children:(L=o[s])==null?void 0:L.avaliador.nome}),e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-widest font-bold",children:"Autor da Avaliação"})]})]})]})})]}),e.jsxs("div",{className:"w-[440px] bg-[#0A0A0A]/80 backdrop-blur-[50px] border-l border-white/5 flex flex-col z-20 shadow-[-40px_0_80px_rgba(0,0,0,0.5)]",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-10 space-y-10 scrollbar-hide",children:[e.jsxs("section",{children:[e.jsx("label",{className:"text-[10px] font-black text-gray-600 uppercase tracking-[0.2em] mb-4 block",children:"Responsável"}),e.jsx("div",{className:"bg-white/5 p-6 rounded-[24px] border border-white/5 hover:bg-white/[0.08] transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-black border border-white/10 flex items-center justify-center overflow-hidden shadow-inner group-hover:border-primary/50 transition-colors",children:e.jsx(ye,{className:"w-8 h-8 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-xl font-bold text-white truncate leading-tight",children:i==="media"?(z=r[s])==null?void 0:z.userName:(F=o[s])==null?void 0:F.avaliador.nome}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"px-2 py-0.5 bg-primary/10 text-primary text-[10px] font-bold rounded uppercase tracking-wider border border-primary/20",children:i==="media"?(B=r[s])==null?void 0:B.userType:"Reviewer"}),e.jsx("span",{className:"text-gray-600 text-[10px] font-bold",children:"•"}),e.jsxs("span",{className:"text-gray-500 text-[10px] font-bold uppercase tracking-wider",children:["ID: ",(i==="media"?(O=r[s])==null?void 0:O.userId:(U=o[s])==null?void 0:U.avaliador.id).substring(0,8)]})]})]})]})})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-600 uppercase tracking-[0.2em]",children:"IA Auditor"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full animate-pulse ${(i==="media"?(q=(W=r[s])==null?void 0:W.aiAnalysis)!=null&&q.isSafe:!((H=(G=o[s])==null?void 0:G.aiAnalysis)!=null&&H.isToxic))?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${(i==="media"?(K=(J=r[s])==null?void 0:J.aiAnalysis)!=null&&K.isSafe:!((V=(Q=o[s])==null?void 0:Q.aiAnalysis)!=null&&V.isToxic))?"text-green-500":"text-red-500"}`,children:(i==="media"?(Y=(X=r[s])==null?void 0:X.aiAnalysis)!=null&&Y.isSafe:!((ee=(Z=o[s])==null?void 0:Z.aiAnalysis)!=null&&ee.isToxic))?"Limpo":"Risco"})]})]}),e.jsxs("div",{className:`p-8 rounded-[32px] border transition-all ${(i==="media"?(te=(ae=r[s])==null?void 0:ae.aiAnalysis)!=null&&te.isSafe:!((ie=(se=o[s])==null?void 0:se.aiAnalysis)!=null&&ie.isToxic))?"bg-green-500/[0.03] border-green-500/10":"bg-red-500/[0.03] border-red-500/10"}`,children:[e.jsx("p",{className:"text-lg text-white leading-relaxed font-medium",children:(i==="media"?(oe=(re=r[s])==null?void 0:re.aiAnalysis)==null?void 0:oe.reason:(ne=(le=o[s])==null?void 0:le.aiAnalysis)==null?void 0:ne.reason)||"Processando análise em tempo real..."}),e.jsxs("div",{className:"mt-6 flex items-center gap-4 text-[10px] font-black uppercase tracking-widest text-gray-600 border-t border-white/5 pt-6",children:[e.jsx("span",{children:"Confiança: 98%"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Modelo: Gemini Flash"})]})]})]})]}),e.jsxs("div",{className:"p-10 bg-black/40 border-t border-white/5 space-y-4",children:[e.jsxs("button",{onClick:I,className:"w-full h-16 bg-white hover:bg-gray-100 text-black rounded-2xl font-black uppercase tracking-widest text-sm flex items-center justify-center gap-3 transition-all transform active:scale-[0.98] shadow-[0_20px_40px_-12px_rgba(255,255,255,0.2)]",children:[e.jsx(we,{className:"w-6 h-6"}),"Aprovar e Próximo"]}),e.jsxs("button",{onClick:()=>{i==="media"&&(_(r[s]),f(!0))},className:"w-full h-16 bg-red-600/10 hover:bg-red-600 text-red-500 hover:text-white rounded-2xl font-black uppercase tracking-widest text-sm flex items-center justify-center gap-3 transition-all border border-red-500/20 active:scale-[0.98]",children:[e.jsx(pe,{className:"w-6 h-6"}),"Rejeitar e Remover"]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary font-poppins",children:"Auditoria de Conteúdo"}),e.jsx("button",{onClick:()=>{h(0),g(!0),S(i==="media"?r[0]:o[0])},className:"bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-2 px-6 rounded-full flex items-center gap-2",children:"⚡ Iniciar Moderação"})]}),e.jsxs("div",{className:"flex border-b border-gray-700 mb-6",children:[e.jsxs("button",{onClick:()=>v("media"),className:`px-6 py-3 text-sm font-bold border-b-2 ${i==="media"?"border-primary text-white":"border-transparent text-gray-400"}`,children:["Mídia (",y.length,")"]}),e.jsxs("button",{onClick:()=>v("reviews"),className:`px-6 py-3 text-sm font-bold border-b-2 ${i==="reviews"?"border-primary text-white":"border-transparent text-gray-400"}`,children:["Avaliações (",w.length,")"]})]}),e.jsx("div",{className:"bg-gray-800 p-6 rounded-xl border border-gray-700",children:i==="media"?e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 gap-4",children:r.map(t=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-700 group",children:[e.jsx("img",{src:t.url,className:"w-full h-full object-cover blur-sm hover:blur-0 transition-all"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-2 transition-opacity",children:e.jsx("button",{onClick:()=>{_(t),f(!0)},className:"p-2 bg-red-600 rounded-full text-white",children:e.jsx(pe,{className:"w-4 h-4"})})})]},t.id))}):e.jsx("div",{className:"space-y-4",children:o.map(t=>e.jsxs("div",{className:"p-4 bg-gray-900 rounded-lg border-l-4 border-red-500 flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-white",children:[t.avaliador.nome," → ",t.alvo.nome]}),e.jsxs("p",{className:"text-gray-400 text-sm italic",children:['"',t.comentario,'"']})]}),e.jsx("span",{className:"text-2xl font-black text-red-400",children:t.nota})]},t.id))})}),e.jsx(je,{isOpen:fe,onClose:()=>f(!1),onConfirm:be,title:"Confirmar Deleção",message:e.jsx("p",{children:"Excluir esta mídia permanentemente?"}),confirmText:"Excluir",isConfirming:he})]})};export{Le as default};
