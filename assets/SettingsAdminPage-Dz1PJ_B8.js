import{j as e,b as w,e as j,u as q,x as C}from"./index-BhcEfvUj.js";import{r as s}from"./vendor-react-Dfcn4nkY.js";import{P as B}from"./PhotographIcon-0Nmszdam.js";import{U as T}from"./UploadIcon-rOGc5_mA.js";import{P as z}from"./PlusIcon-DLBUjVRZ.js";import{T as O}from"./TrashIcon-pFEM47VR.js";import"./vendor-pdf-DHYqqgbQ.js";import"./vendor-utils-DmyZJLyO.js";import"./vendor-ui-DKtFGipk.js";const L=c=>{let t=document.querySelector("link[rel~='icon']");t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t)),t.href=c},A=({bucketName:c,fileName:t,label:u,description:l,onUploadSuccess:v})=>{const[S,y]=s.useState(null),[N,x]=s.useState(!1),[o,h]=s.useState(""),[b,n]=s.useState(""),f=()=>{const{data:i}=w.storage.from(c).getPublicUrl(t);fetch(i.publicUrl).then(r=>{r.ok?y(`${i.publicUrl}?t=${new Date().getTime()}`):y(null)}).catch(()=>y(null))};s.useEffect(()=>{f()},[c,t]),s.useEffect(()=>{if(o||b){const i=setTimeout(()=>{h(""),n("")},5e3);return()=>clearTimeout(i)}},[o,b]);const m=async i=>{h(""),n(""),x(!0);try{if(!i.target.files||i.target.files.length===0)throw new Error("Você deve selecionar um arquivo para enviar.");const r=i.target.files[0],{error:d}=await w.storage.from(c).upload(t,r,{upsert:!0});if(d)throw d;h(`${u} atualizado com sucesso!`);const p=`${w.storage.from(c).getPublicUrl(t).data.publicUrl}?t=${new Date().getTime()}`;y(p),t.includes("favicon")&&L(p),v&&v()}catch(r){const d=j(r);let p=`Erro ao enviar ${u.toLowerCase()}: ${d}`;d&&d.toLowerCase().includes("bucket not found")&&(p=`Erro: O bucket de armazenamento '${c}' não foi encontrado no Supabase. Verifique se ele foi criado e configurado como público.`),n(p)}finally{x(!1)}};return e.jsxs("div",{className:"bg-gray-900 p-4 rounded-md",children:[e.jsx("h3",{className:"font-semibold text-white",children:u}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:l}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-800 rounded-md flex items-center justify-center",children:S?e.jsx("img",{src:S,alt:`${u} Preview`,className:"w-full h-full object-contain rounded-md"}):e.jsx(B,{className:"w-10 h-10 text-gray-600"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("label",{htmlFor:`upload-${t}`,className:"w-full sm:w-auto flex justify-center items-center gap-2 px-4 py-2 border border-gray-600 rounded-md cursor-pointer hover:bg-gray-700/50 hover:border-primary transition-colors text-sm font-semibold",children:[e.jsx(T,{className:"w-5 h-5"}),N?"Enviando...":`Carregar ${u}`]}),e.jsx("input",{type:"file",id:`upload-${t}`,onChange:m,disabled:N,className:"hidden",accept:"image/png, image/jpeg, image/svg+xml, image/x-icon"})]})]}),o&&e.jsx("p",{className:"mt-2 text-sm text-green-400",children:o}),b&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:b})]})},W=()=>{const{refreshSiteConfig:c,genres:t,refreshGenres:u,siteConfig:l}=q(),[v,S]=s.useState([]),[y,N]=s.useState(!0),[x,o]=s.useState(null),[h,b]=s.useState("logo_and_name"),[n,f]=s.useState({opacity:.6,blur:0,color:"#000000"}),[m,i]=s.useState({head:"",bodyStart:"",bodyEnd:""}),[r,d]=s.useState({supabaseUrl:"",supabaseAnonKey:"",geminiApiKey:"",stripePublishableKey:""}),[p,E]=s.useState(""),[P,U]=s.useState(!1);s.useEffect(()=>{if(x){const a=setTimeout(()=>o(null),5e3);return()=>clearTimeout(a)}},[x]),s.useEffect(()=>{b(l.brandingOption),f({opacity:l.heroOpacity,blur:l.heroBlur,color:l.heroOverlayColor}),i({head:l.scriptHead||"",bodyStart:l.scriptBodyStart||"",bodyEnd:l.scriptBodyEnd||""}),d({supabaseUrl:l.supabaseUrl||"",supabaseAnonKey:l.supabaseAnonKey||"",geminiApiKey:l.geminiApiKey||"",stripePublishableKey:l.stripePublishableKey||""}),(async()=>{N(!0);try{const{data:g,error:K}=await w.from("usuarios").select("*").in("role",["moderador","analista"]).order("nome",{ascending:!0});if(K)throw K;S(g||[])}catch(g){console.error("Error fetching staff data:",g),o({message:"Erro ao carregar equipe: "+j(g),type:"error"})}finally{N(!1)}})()},[l]);const k=async()=>{try{await C.updateSystemConfig({brandingOption:h,heroOpacity:n.opacity,heroBlur:n.blur,heroOverlayColor:n.color,scriptHead:m.head,scriptBodyStart:m.bodyStart,scriptBodyEnd:m.bodyEnd,supabaseUrl:r.supabaseUrl,supabaseAnonKey:r.supabaseAnonKey,geminiApiKey:r.geminiApiKey,stripePublishableKey:r.stripePublishableKey}),c(),o({message:"Configurações visuais salvas com sucesso.",type:"success"})}catch(a){o({message:"Erro ao salvar: "+j(a),type:"error"})}},I=async()=>{try{await C.updateHomeBackground("home-bg.jpg"),c(),o({message:"Imagem de fundo atualizada com sucesso.",type:"success"})}catch(a){o({message:"Imagem enviada, mas falha ao atualizar config: "+j(a),type:"error"})}},G=async a=>{if(a.preventDefault(),!!p.trim()){U(!0);try{await C.addGenre(p.trim()),E(""),u(),o({message:"Gênero adicionado.",type:"success"})}catch(g){o({message:"Erro ao adicionar gênero: "+j(g),type:"error"})}finally{U(!1)}}},$=async a=>{if(window.confirm("Tem certeza que deseja remover este gênero?"))try{await C.removeGenre(a),u(),o({message:"Gênero removido.",type:"success"})}catch(g){o({message:"Erro ao remover gênero: "+j(g),type:"error"})}};return e.jsxs("div",{className:"text-white animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-primary font-poppins",children:"Configurações do Sistema"}),e.jsx("p",{className:"text-gray-400",children:"Gerencie a identidade visual, recursos globais e permissões."})]}),e.jsx("button",{onClick:k,className:"bg-primary hover:bg-primary/90 text-dark font-bold py-2 px-6 rounded-lg shadow-lg transition-all transform hover:scale-105",children:"Salvar Alterações"})]}),x&&e.jsx("div",{className:`p-4 mb-6 rounded-md ${x.type==="success"?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-300"}`,children:x.message}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 border-b border-gray-700 pb-2",children:"Identidade Visual"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Exibição da Marca no Header"}),e.jsx("div",{className:"flex gap-4",children:[{value:"logo",label:"Apenas Logo"},{value:"name",label:"Apenas Nome"},{value:"logo_and_name",label:"Logo + Nome"}].map(a=>e.jsx("button",{onClick:()=>b(a.value),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors border ${h===a.value?"bg-primary/20 border-primary text-primary":"bg-gray-900 border-gray-600 text-gray-400 hover:bg-gray-700"}`,children:a.label},a.value))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{bucketName:"site",fileName:"logo.png",label:"Logo Principal",description:"Imagem exibida no cabeçalho (Recomendado: PNG transparente).",onUploadSuccess:c}),e.jsx(A,{bucketName:"site",fileName:"favicon.ico",label:"Favicon",description:"Ícone da aba do navegador (.ico ou .png).",onUploadSuccess:()=>{}}),e.jsxs("div",{className:"border-t border-gray-700 pt-6",children:[e.jsx("h3",{className:"font-bold text-white mb-4",children:"Hero (Banner Principal)"}),e.jsx(A,{bucketName:"site",fileName:"home-bg.jpg",label:"Imagem de Fundo",description:"Imagem de alta resolução para o banner principal.",onUploadSuccess:I}),e.jsxs("div",{className:"mt-6 space-y-4 bg-gray-900 p-4 rounded-lg border border-gray-700",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Opacidade da Camada Escura"}),e.jsxs("span",{className:"text-xs text-primary font-mono",children:[Math.round(n.opacity*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:n.opacity,onChange:a=>f({...n,opacity:parseFloat(a.target.value)}),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Desfoque (Blur)"}),e.jsxs("span",{className:"text-xs text-primary font-mono",children:[n.blur,"px"]})]}),e.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:n.blur,onChange:a=>f({...n,blur:parseInt(a.target.value)}),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Cor da Camada"}),e.jsx("input",{type:"color",value:n.color,onChange:a=>f({...n,color:a.target.value}),className:"h-8 w-16 bg-transparent border border-gray-600 rounded cursor-pointer"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-2 text-center",children:'* Clique em "Salvar Alterações" no topo para aplicar.'})]})]})]})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 border-b border-gray-700 pb-2",children:"Scripts Externos & Tags"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Injete scripts customizados (GA4, Facebook Pixel, GTM) em partes específicas do site."}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Scripts no <head>"}),e.jsx("textarea",{value:m.head,onChange:a=>i({...m,head:a.target.value}),placeholder:"<!-- Google Tag Manager --> ...",className:"w-full h-32 bg-gray-900 border border-gray-600 rounded-md p-3 text-xs font-mono text-gray-300 focus:ring-1 focus:ring-primary outline-none"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"Carregado antes de qualquer outro conteúdo."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Scripts no Início do <body>"}),e.jsx("textarea",{value:m.bodyStart,onChange:a=>i({...m,bodyStart:a.target.value}),placeholder:"<!-- GTM noscript --> ...",className:"w-full h-32 bg-gray-900 border border-gray-600 rounded-md p-3 text-xs font-mono text-gray-300 focus:ring-1 focus:ring-primary outline-none"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"Ideal para tags noscript ou widgets de chat."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Scripts no Final do <body>"}),e.jsx("textarea",{value:m.bodyEnd,onChange:a=>i({...m,bodyEnd:a.target.value}),placeholder:"<!-- Custom scripts --> ...",className:"w-full h-32 bg-gray-900 border border-gray-600 rounded-md p-3 text-xs font-mono text-gray-300 focus:ring-1 focus:ring-primary outline-none"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"Carregado após toda a estrutura visual estar pronta."})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 border-b border-gray-700 pb-2",children:"Gêneros Musicais"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Adicione ou remova gêneros disponíveis para os artistas."}),e.jsxs("form",{onSubmit:G,className:"flex gap-2 mb-6",children:[e.jsx("input",{type:"text",value:p,onChange:a=>E(a.target.value),placeholder:"Novo Gênero (ex: Jazz Fusion)",className:"flex-grow bg-gray-900 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-primary text-sm"}),e.jsx("button",{type:"submit",disabled:P||!p.trim(),className:"bg-primary hover:bg-primary/80 text-dark font-bold px-4 py-2 rounded-md transition-colors disabled:opacity-50",children:e.jsx(z,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-60 overflow-y-auto custom-scrollbar p-1",children:t.length>0?t.map(a=>e.jsxs("div",{className:"group flex items-center gap-2 bg-gray-900 border border-gray-600 px-3 py-1.5 rounded-full text-sm hover:border-primary transition-colors",children:[e.jsx("span",{className:"text-gray-200",children:a.nome}),e.jsx("button",{onClick:()=>$(a.id),className:"text-gray-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Remover",children:e.jsx(O,{className:"w-3 h-3"})})]},a.id)):e.jsx("p",{className:"text-gray-500 italic text-sm",children:"Nenhum gênero cadastrado."})})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg border-l-4 border-l-red-500",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4 border-b border-gray-700 pb-2 flex items-center gap-2",children:"Chaves de API & Integrações"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6 font-medium bg-red-500/10 p-2 rounded border border-red-500/20",children:"Cuidado: Estas chaves são sensíveis. Apenas altere se souber o que está fazendo."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Supabase URL"}),e.jsx("input",{type:"text",value:r.supabaseUrl,onChange:a=>d({...r,supabaseUrl:a.target.value}),className:"w-full bg-gray-900 border border-gray-700 rounded-md py-2 px-3 text-sm text-gray-300 font-mono",placeholder:"https://your-project.supabase.co"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Supabase Anon Key"}),e.jsx("input",{type:"password",value:r.supabaseAnonKey,onChange:a=>d({...r,supabaseAnonKey:a.target.value}),className:"w-full bg-gray-900 border border-gray-700 rounded-md py-2 px-3 text-sm text-gray-300 font-mono",placeholder:"eyJhbGciOiJIUzI1..."})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-700 mt-4",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Gemini AI API Key"}),e.jsx("input",{type:"password",value:r.geminiApiKey,onChange:a=>d({...r,geminiApiKey:a.target.value}),className:"w-full bg-gray-900 border border-gray-700 rounded-md py-2 px-3 text-sm text-gray-300 font-mono",placeholder:"AIzaSy..."}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1 italic",children:"Usada para Matchmaking e Análise de Sentimento."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-1",children:"Stripe Publishable Key"}),e.jsx("input",{type:"text",value:r.stripePublishableKey,onChange:a=>d({...r,stripePublishableKey:a.target.value}),className:"w-full bg-gray-900 border border-gray-700 rounded-md py-2 px-3 text-sm text-gray-300 font-mono",placeholder:"pk_test_..."})]})]})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg",children:[e.jsx("div",{className:"flex justify-between items-center mb-4 border-b border-gray-700 pb-2",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Equipe Administrativa"})}),y?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Carregando equipe..."}):v.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Nenhum membro da equipe encontrado."}):e.jsx("div",{className:"space-y-3",children:v.map(a=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-900 p-3 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center font-bold text-xs text-gray-400 overflow-hidden",children:a.foto_url?e.jsx("img",{src:w.storage.from("perfis").getPublicUrl(a.foto_url).data.publicUrl,alt:a.nome,className:"w-full h-full object-cover"}):a.nome.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-white",children:a.nome}),e.jsx("p",{className:"text-xs text-gray-500",children:a.email})]})]}),e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-gray-800 text-gray-300 border border-gray-600 capitalize",children:a.role})]},a.id))}),e.jsx("p",{className:"text-xs text-gray-500 mt-4 text-center",children:"Para adicionar novos administradores, altere o 'role' do usuário na página de Usuários ou diretamente no banco de dados."})]})]})]})]})};export{W as default};
