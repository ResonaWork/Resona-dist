import{r as o,j as e,A as D,e as P,b as _,C as W,c as O,n as K}from"./index-v9YSdgyP.js";import{C as Y,i as U,a as ee}from"./ChevronLeftIcon-CI9PxyOd.js";import{S as E}from"./financeUtils-CtoX7Xu7.js";import{C as A}from"./CheckCircleIcon-Cv8yAk67.js";import{C as I}from"./ChevronRightIcon-BrCn-GTD.js";import{S as ae}from"./SearchIcon-BLScH6Us.js";import{F as te}from"./FileSignatureIcon-Bv2SxWom.js";import{L as se}from"./LockClosedIcon-B2CPVpEJ.js";import{S as $}from"./SparklesIcon-HYa85XV_.js";import{C as re}from"./ClockIcon-Cjd2BCsI.js";import{E as oe}from"./ExclamationIcon-CaMJBUfc.js";const le=r=>{const l=(r==null?void 0:r.toLowerCase())||"";return l.includes("amigável")?{color:"text-green-400",bg:"bg-green-500/10",border:"border-green-500/30",label:"Match Alto"}:l.includes("tenso")?{color:"text-red-400",bg:"bg-red-500/10",border:"border-red-500/30",label:"Risco de Conflito"}:l.includes("cauteloso")?{color:"text-yellow-400",bg:"bg-yellow-500/10",border:"border-yellow-500/30",label:"Atenção às Cláusulas"}:{color:"text-indigo-300",bg:"bg-indigo-500/10",border:"border-indigo-500/30",label:"Formal e Direto"}},ne=({contractData:r,userId:l})=>{var p,f;const[x,b]=o.useState(""),[s,d]=o.useState(null),[i,g]=o.useState(!1),S=async()=>{g(!0);try{const n=await D.analyzeProposal(r,x);d(n),await D.saveLog({contrato_id:r.id||"new_proposal",usuario_id:l,mensagem_usuario:x,analise_ia:n})}catch(n){alert("Erro na mediação: "+P(n))}finally{g(!1)}},m=le(s==null?void 0:s.mood);return e.jsxs("div",{className:"bg-gray-850 rounded-2xl border border-indigo-500/30 overflow-hidden shadow-2xl animate-fade-in",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-900/40 to-gray-800 p-4 border-b border-indigo-500/20 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-500/20 rounded-lg flex items-center justify-center border border-indigo-500/40",children:e.jsx($,{className:"w-5 h-5 text-indigo-400 animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-white leading-none",children:"Mediador RESONNA"}),e.jsx("p",{className:"text-[10px] text-indigo-300 uppercase font-black tracking-widest mt-1",children:"Inteligência Estratégica"})]})]}),e.jsx("div",{className:"p-5 space-y-4",children:s?e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsxs("div",{className:`p-3 rounded-xl border ${m.bg} ${m.border}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("p",{className:`text-[10px] font-black uppercase ${m.color}`,children:m.label}),e.jsx("span",{className:`text-[10px] font-bold ${m.color}`,children:s.mood})]}),e.jsxs("p",{className:"text-xs text-gray-200 italic leading-relaxed",children:['"',s.verdict,'"']})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] font-black text-red-400 uppercase mb-2 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Alertas de Risco"]}),((p=s.risks)==null?void 0:p.length)>0?e.jsx("ul",{className:"space-y-1",children:s.risks.map((n,u)=>e.jsxs("li",{className:"text-[10px] text-gray-400 flex gap-2",children:[e.jsx("span",{className:"text-red-500",children:"•"})," ",n]},u))}):e.jsx("p",{className:"text-[10px] text-gray-500 italic",children:"Nenhum risco detectado na proposta atual."})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] font-black text-green-400 uppercase mb-2 flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"})," Plano de Ação"]}),e.jsx("div",{className:"space-y-2",children:((f=s.suggestions)==null?void 0:f.length)>0?s.suggestions.map((n,u)=>e.jsx("div",{className:"p-2 bg-gray-900 rounded-lg border border-gray-800 text-[10px] text-gray-300",children:n},u)):e.jsx("div",{className:"p-2 bg-green-500/5 rounded-lg border border-green-500/20 text-[10px] text-green-300",children:"Proposta sólida. Siga para a assinatura conforme planejado."})})]}),e.jsx("div",{className:"pt-3 border-t border-gray-800 text-center",children:e.jsx("button",{onClick:()=>d(null),className:"text-[9px] text-indigo-400 underline uppercase font-bold hover:text-white transition-colors",children:"Nova Consulta de Proposta"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-400 leading-relaxed",children:"Deseja que a IA analise esta proposta? Ela verificará se os valores estão justos e se as cláusulas protegem sua agenda."}),e.jsx("textarea",{value:x,onChange:n=>b(n.target.value),placeholder:"Dúvida? (Ex: Este valor está baixo para 3h de show?)",className:"w-full bg-gray-900 border border-gray-700 rounded-xl p-3 text-xs text-white focus:ring-1 focus:ring-indigo-500 outline-none resize-none h-20"}),e.jsxs("button",{onClick:S,disabled:i,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2 text-xs uppercase tracking-widest shadow-lg shadow-indigo-900/20",children:[i?e.jsx(re,{className:"w-4 h-4 animate-spin"}):e.jsx($,{className:"w-4 h-4"}),i?"Analisando Mercado...":"Consultar Mediador"]})]})})]})},L=19,N=r=>r.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),F=(r,l,x,b,s,d)=>{const i=new Date(x).toLocaleDateString("pt-BR",{timeZone:"UTC"}),g=N(b);return`CONTRATO DE PRESTAÇÃO DE SERVIÇOS ARTÍSTICOS

ENTRE:
CONTRATANTE: ${r}
CONTRATADO: ${l}

CLÁUSULA 1ª - DO OBJETO
Apresentação musical na data de ${i}.

CLÁUSULA 2ª - DO PAGAMENTO E LIQUIDAÇÃO
O valor acordado é de ${g}.
${d==="platform"?"O pagamento total será feito via RESONA, com garantia de custódia (Escrow).":"O pagamento do cachê será realizado EXTERNAMENTE (por fora da plataforma). Este contrato serve para formalização jurídica e garantia de cumprimento de agenda."}

CLÁUSULA 3ª - OBSERVAÇÕES
${s||"Nenhuma condição adicional."}`},ye=({currentUserProfile:r,targetProfile:l,onClose:x,onContractCreated:b})=>{const[s,d]=o.useState(1),[i,g]=o.useState(""),[S,m]=o.useState([]),[p,f]=o.useState(null),[n,u]=o.useState(!1),[a,y]=o.useState({data_evento:"",valorRaw:0,valorDisplay:"",condicoes:"",paymentModel:"platform"}),[R,k]=o.useState(!1),[h,v]=o.useState(""),[z,B]=o.useState(!1),C=r.tipo==="artista"?"estabelecimento":"artista";o.useEffect(()=>{l&&(f(l),d(2))},[l]),o.useEffect(()=>{let t=!0;if(i.length<2){m([]);return}const w=setTimeout(async()=>{u(!0);try{const c=await _.search(i,C);t&&m(c)}catch(c){console.error("Search error:",c)}finally{t&&u(!1)}},500);return()=>{t=!1,clearTimeout(w)}},[i,C]);const V=t=>{f(t),d(2)},G=t=>{const c=t.target.value.replace(/\D/g,""),j=Number(c)/100;y(M=>({...M,valorRaw:j,valorDisplay:j.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}))},Q=()=>{if(s===2){if(!a.data_evento){v("Selecione a data do show.");return}const t=new Date;if(t.setHours(0,0,0,0),new Date(`${a.data_evento}T00:00:00.000Z`).getTime()<t.getTime()){v("A data do evento não pode ser no passado.");return}}if(s===3&&a.valorRaw<=0){v("Defina o valor do cachê.");return}v(""),d(t=>t+1)},Z=async()=>{if(!(!p||!a.data_evento)){k(!0);try{if(await _.checkSuspensionStatus(r.id))throw new Error("Sua conta está suspensa e não pode realizar novos contratos.");if(!(r.tipo==="artista"?U(r).complete:ee(r).complete))throw new Error("Seu perfil está incompleto. Preencha todos os dados obrigatórios na aba 'Perfil' antes de criar contratos.");const c=r.tipo==="artista"?r:p,j=r.tipo==="estabelecimento"?r:p;if(!await O.checkAvailability(c.artista.id,a.data_evento))throw new Error("O artista já possui compromisso confirmado nesta data.");const X=a.paymentModel==="platform"?a.valorRaw*E:L,H=F(j.nome,c.nome,a.data_evento,a.valorRaw,a.condicoes,a.paymentModel),J=await O.create({artista_id:c.artista.id,estabelecimento_id:j.estabelecimento.id,data_evento:a.data_evento,valor:a.valorRaw,taxa_servico:X,condicoes:H});await K.create({usuario_id:p.id,tipo:"contrato",titulo:`Nova proposta de ${r.nome}`,descricao:`Proposta de ${N(a.valorRaw)} via ${a.paymentModel==="platform"?"Plataforma":"Pagamento Externo"}.`,url_destino:`/contratos/${J.id}`}),b(),x()}catch(t){v(P(t))}finally{k(!1)}}},q=a.paymentModel==="platform"?a.valorRaw*(1+E):a.valorRaw,T=a.paymentModel==="platform"?a.valorRaw*E:L;return e.jsx("div",{className:"fixed inset-0 bg-black/90 z-50 flex justify-center items-center p-4 backdrop-blur-sm",onClick:()=>B(!0),children:e.jsxs("div",{className:`bg-gray-900 text-white rounded-3xl shadow-2xl w-full max-w-5xl relative flex flex-col max-h-[90vh] border border-gray-800 ${z?"shake":""}`,onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"p-6 border-b border-gray-800 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Gerar Novo Contrato"}),e.jsx("button",{onClick:x,className:"text-gray-500 hover:text-white p-2",children:e.jsx(W,{})})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row flex-grow overflow-hidden",children:[e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow bg-gray-950",children:[s===1&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h3",{className:"text-lg font-bold mb-6 text-center",children:"Para quem é este contrato?"}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("input",{type:"text",value:i,onChange:t=>g(t.target.value),placeholder:`Buscar ${C}...`,className:"w-full bg-gray-800 border border-gray-700 rounded-2xl py-4 pl-12 pr-4 text-white focus:ring-2 focus:ring-primary outline-none"}),e.jsx(ae,{className:"absolute left-4 top-4.5 w-6 h-6 text-gray-500"})]}),e.jsx("div",{className:"space-y-3",children:S.map(t=>e.jsxs("button",{onClick:()=>V(t),className:"w-full text-left p-4 rounded-2xl border border-gray-800 bg-gray-900 hover:border-primary transition-all flex items-center justify-between",children:[e.jsx("span",{className:"font-bold",children:t.nome}),e.jsx(I,{className:"w-5 h-5 text-gray-600"})]},t.id))})]}),s===2&&e.jsxs("div",{className:"animate-fade-in space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-400 mb-2",children:"Data do Evento"}),e.jsx("input",{type:"date",value:a.data_evento,min:new Date().toISOString().split("T")[0],onChange:t=>y({...a,data_evento:t.target.value}),className:"w-full bg-gray-800 border border-gray-700 rounded-xl p-4 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-400 mb-2",children:"Condições Adicionais"}),e.jsx("textarea",{rows:4,value:a.condicoes,onChange:t=>y({...a,condicoes:t.target.value}),className:"w-full bg-gray-800 border border-gray-700 rounded-xl p-4 text-white resize-none",placeholder:"Ex: Passagem de som às 18h..."})]}),h&&e.jsx("p",{className:"text-red-400 text-sm font-bold",children:h})]}),s===3&&e.jsxs("div",{className:"animate-fade-in space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-400 mb-2",children:"Qual o valor do Cachê?"}),e.jsx("input",{type:"text",value:a.valorDisplay,onChange:G,className:"w-full bg-transparent border-b-2 border-gray-700 text-4xl font-black text-white py-4 outline-none focus:border-primary transition-colors text-center font-mono",placeholder:"R$ 0,00"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>y({...a,paymentModel:"platform"}),className:`p-6 rounded-2xl border-2 text-left transition-all ${a.paymentModel==="platform"?"border-primary bg-primary/5":"border-gray-800 hover:border-gray-700"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx(se,{className:a.paymentModel==="platform"?"text-primary":"text-gray-500"}),a.paymentModel==="platform"&&e.jsx(A,{className:"text-primary w-5 h-5"})]}),e.jsx("h4",{className:"font-bold text-white mb-1",children:"Segurança Total"}),e.jsx("p",{className:"text-xs text-gray-400 leading-relaxed",children:"Pagamento via plataforma com custódia (Escrow). Taxa de 10%."})]}),e.jsxs("button",{onClick:()=>y({...a,paymentModel:"external"}),className:`p-6 rounded-2xl border-2 text-left transition-all ${a.paymentModel==="external"?"border-secondary bg-secondary/5":"border-gray-800 hover:border-gray-700"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx(te,{className:a.paymentModel==="external"?"text-secondary":"text-gray-500"}),a.paymentModel==="external"&&e.jsx(A,{className:"text-secondary w-5 h-5"})]}),e.jsx("h4",{className:"font-bold text-white mb-1",children:"Apenas Formalização"}),e.jsx("p",{className:"text-xs text-gray-400 leading-relaxed",children:"Pagamento do cachê é feito por fora. Taxa fixa de R$ 19,00 para o contrato."})]})]}),e.jsxs("div",{className:"bg-gray-900 p-6 rounded-2xl border border-gray-800",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[e.jsx("span",{children:"Cachê Artista"}),e.jsx("span",{children:N(a.valorRaw)})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-4",children:[e.jsxs("span",{children:["Taxa RESONA (",a.paymentModel==="platform"?"10%":"Fixa",")"]}),e.jsx("span",{children:N(T)})]}),e.jsxs("div",{className:"flex justify-between font-black text-xl border-t border-gray-800 pt-4",children:[e.jsx("span",{className:"text-white",children:"Total a Pagar"}),e.jsx("span",{className:"text-primary",children:N(a.paymentModel==="platform"?q:T)})]})]}),h&&e.jsx("p",{className:"text-red-400 text-sm font-bold",children:h})]}),s===4&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Minuta do Contrato"}),e.jsx("div",{className:"bg-white text-dark p-8 rounded-xl font-serif text-sm leading-relaxed whitespace-pre-wrap max-h-96 overflow-y-auto border border-gray-700",children:F(r.nome,p.nome,a.data_evento,a.valorRaw,a.condicoes,a.paymentModel)}),h&&e.jsx("p",{className:"mt-4 text-red-400 text-sm font-bold",children:h})]})]}),s>=2&&e.jsx("div",{className:"w-full lg:w-80 bg-gray-900 border-l border-gray-800 p-4 shrink-0 hidden lg:block",children:e.jsx(ne,{contractData:{valor:a.valorRaw,data_evento:a.data_evento,condicoes:a.condicoes},userId:r.id})})]}),e.jsxs("div",{className:"p-6 border-t border-gray-800 flex justify-between gap-4 bg-gray-900",children:[s>1&&e.jsxs("button",{onClick:()=>d(s-1),className:"flex-1 py-4 rounded-xl font-bold bg-gray-800 hover:bg-gray-700 flex items-center justify-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"})," Voltar"]}),e.jsxs("button",{onClick:s===4?Z:Q,disabled:R,className:"flex-[2] py-4 rounded-xl font-black bg-primary text-dark hover:bg-white transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2",children:[R?"Processando...":s===4?"Gerar & Enviar":"Continuar",e.jsx(I,{className:"w-5 h-5"})]})]})]})})};export{ye as C};
